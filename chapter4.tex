\chapter{ПРИМЕНЕНИЕ EMPC К РЕШЕНИЮ ЗАДАЧ ОБ ОПТИМАЛЬНОМ РОСТЕ ТЕХНОЛОГИЧЕСКОГО ПОСЛЕДОВАТЕЛЯ}\label{chap4}

В настоящей главе применим метод EMPC к решению задачи об оптимальном росте технологического  последователя. При этом рассмотрим три подхода:
\begin{enumerate}
  \item базовый EMPC без дополнительных ограничений(неограниченный EMPC)\cite{Grune};
  \item EPMC с терминальным ограничением-равенством;
  \item подход, в котором критерий качества дополняется специальной выбранной терминальной стоимостью.
\end{enumerate}
Последний подход --- новый, предлагается в данной работе впервые. Цель --- упростить задачу оптимального управления с точки зрения численного решения, поскольку задачи без жестких ограничений-равенств проще с вычислительной точки зрения. В главе проводится сравнение решений, полученных всеми тремя подходами, а также сравнение с решением задачи (\ref{redzou}) на основе Принципа максимума из главы \ref{chap2}.

\section{Прогнозирующие задачи оптимального управления}

В данной главе будем сравнивать результаты решения задачи об оптимальном росте технологического последователя методом ЕМРС с тремя различными прогнозирующими задачами. Ниже приводятся формулировки этих задач. Напомним, что прогнозирующие задачи в текущий момент $\tau$ имеют конечный горизонт управления $[\tau, \tau+T]$, а в качестве начального состояния для прогнозирующей модели выбирается текущее состояние, которое для редуцированной системы будет иметь вид $x(\tau)/y(\tau)$, где $x(\tau)$, $y(\tau)$ измеряемые текущие значения накопленных технологий стран $B$ и $A$, соответственно.

1) Прогнозирующая задача оптимального управления без дополнительных ограничений и терминальной стоимости, применяемая в так называемом неограниченном ЕМРС, имеет вид (см. \cite{Grune}):
$$
    I_1(z,u) = \int_\tau^{\tau+T}e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{41}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T].
    $$

Недостаток этого вида задачи состоит в том, что требуется достаточно длинный горизонт управления. Но даже несмотря на это, траектория замкнутой системы  может не выходить к магистрали и стабилизируется в окрестности некоторой точки. Увеличение горизонта, как правило, позволяет добиться того, чтобы траектория замкнутой системы асимптотически приближалась к магистрали. Однако, при этом заметно растет трудоемкость численного решения задачи оптимального управления (\ref{41}). Возможна ситуация, когда решение (\ref{41}) уже невозможно построить в реальном времени, т.е. за время, не превосходящее $h$.

2) Прогнозирующую задачу оптимального управления (\ref{41}) дополним терминальным ограничением-равенством:
$$
    I_2(z,u) = \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{42}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t),
\end{equation}
$$
z(\tau) = \frac{x(\tau)}{y(\tau)}, \ z(\tau+T)=\frac{x_s}{y_s},
$$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
т.е. добавим требование, чтобы $z$ к моменту $\tau + T$ равнялась магистральному значению. Однако, вычислительные трудности не исчезают, может возникнуть ситуация, когда не существует ни одного допустимого управления, переводящего систему в состояние $x_s/y_s$.

3) В подходе, предлагаемом в данной дипломной работе дополним критерий качества задачи (\ref{41})  специально подобранной линейной (по фазовой переменной $z$) терминальной стоимостью:
$$
    I_3(z,u) =e^{-\rho(\tau+T) }\lambda_s z(\tau+T) + \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{43}
    \dot{z}(t)=u(t)(z(t)+\gamma) - \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
где $\lambda_s$ --- весовой коэффициент, выбор которого будет обоснован

\bigskip

В отличие от (\ref{42}) задача (\ref{43}) имеет решение при любом значении горизонта $T$. Далее в вычислительных экспериментах также покажем, что, в отличие от (\ref{41}), она обеспечивает асимптотическую устойчивость магистрали при небольших $T$.

\section{Оптимальное программное решение с применением Direct Single Shooting}

Для реализации алгоритма МРС из раздела \ref{mpcu} необходимо на шаге 2 решать прогнозирующую задачу оптимального управления, т.е. находить программное решение задач (\ref{41}), (\ref{42}), (\ref{43}).

Прогнозирующие задачи будут решаться численно с применением метода DSS из раздела 1.3, поэтому дальнейшее изложение будет посвящено программной реализации численных методов для решения задач (\ref{41}), (\ref{42}), (\ref{43}).

Приведем реализацию ..... в Matlab использованием CasADi..... для самой простой задачи, коей является (\ref{41}).

Для начала объявим переменные и уравнения с которыми будем работать:
\begin{lstlisting}
z1 = SX.sym('z1');
t = SX.sym('t');
u = SX.sym('u');

zdot = [(z1 + gamma)*u - nu*z1];

\end{lstlisting}

Подинтегральная функция критерия качества:
\begin{lstlisting}
f0 = -exp(-rho*t)*(kappa*log(z1)+log(b-u));
\end{lstlisting}

Применим алгоритм Рунге-Кутты четвертого порядка для решения ОДУ:

\begin{lstlisting}
M = 4;
DT = T/N/M;
f = Function('f', {z1, u, t}, {zdot, f0});
X0 = MX.sym('X0', 1);
U = MX.sym('U');
tt = MX.sym('tt');
X = X0;
Q = 0;
for j=1:M
   [k1, k1_q] = f(X, U, tt);
   [k2, k2_q] = f(X + DT/2 * k1, U, tt+DT/2);
   [k3, k3_q] = f(X + DT/2 * k2, U,tt+DT/2);
   [k4, k4_q] = f(X + DT * k3, U,tt+DT);
   X=X+DT/6*(k1 +2*k2 +2*k3 +k4);
   Q = Q + DT/6*(k1_q + 2*k2_q + 2*k3_q + k4_q);
end
F = Function('F', {X0, U, tt}, {X, Q},
     {'x0','p','t'}, {'xf', 'qf'});
\end{lstlisting}

После формулировки задачи нелинейного программирования и задача (\ref{41}) решается стандартной процедурой solver :

\begin{lstlisting}

nlp = struct('f', J, 'x', w{:}', 'g', g{:}');
solver = nlpsol('solver', 'ipopt', nlp);

sol = solver('x0', w0, 'lbx', lbw, 'ubx', ubw, ...
             'lbg', lbg, 'ubg', ubg);
w_opt = full(sol.x);

\end{lstlisting}

\section{Результаты численных экспериментов Direct Single Shooting}

Рассмотрим различные решения задачи (\ref{41}) в зависимости от изменений параметров:
\begin{itemize}
\item $b$ -- размеры трудовых ресурсов,
\item $\gamma$ -- емкость абсорбции,
\item $\rho$ -- параметр дисконтирования,
\item $\nu$ -- рост научно-исследовательского сектора страны А,
\item $\kappa$ -- параметр эластичности замещения.
\end{itemize}

Пусть начальное количество технологий страны лидера ($y_0$) в три раза превышает страны последователя ($x_0$).
Для начала положим $\gamma = 0.1$, $\nu = 0.6$ $b=1$, $\rho = 0.5$, $\kappa = 0.9$.

Полученный результат изображен на рисунке \ref{fig:m1}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{1sT3V06B1P05K09XY13g01.png}
\caption{Решение для параметров: $\gamma = 0.1$, $\nu = 0.6$ $b=1$, $\rho = 0.5$, $\kappa = 0.9$}
\label{fig:m1}

\end{figure}

Положим $\gamma = 0.5$, $\nu = 0.1$ $b=1$, $\rho = 0.3$, $\kappa = 0.3$ рисунок \ref{fig:m5}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{k03p05b09g05nu01.png}
\caption{Решение для параметров: $\gamma = 0.5$, $\nu = 0.1$ $b=1$, $\rho = 0.3$, $\kappa = 0.3$}
\label{fig:m5}

\end{figure}

Положим $\gamma = 0.9$, $\nu = 0.5$ $b=1$ $\rho = 0.5$ $\kappa = 0.5$  изменения отображены на рисунке \ref{fig:m9}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{6sT3V05B1P05K05XY13g09.png}
\caption{Решение для параметров: $\gamma = 0.9$, $\nu = 0.5$ $b=1$, $\rho = 0.5$, $\kappa = 0.5$}
\label{fig:m9}

\end{figure}

Изменим параметры:$\gamma = 0.6$, $\nu = 0.7$ $b=1$, $\rho = 0.5$, $\kappa = 0.3$. На рисунке \ref{fig:m2}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{k03p03b1g06nu07.png}
\caption{Решение для параметров: $\gamma = 0.6$, $\nu = 0.7$ $b=1$, $\rho = 0.5$, $\kappa = 0.3$}
\label{fig:m2}

\end{figure}

Изменим параметр $\kappa = 0.5$ . Результат отображен на рисунке \ref{fig:m3}. 

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{1sT3V06B1P05K05XY13g01.png}
\caption{Решение для параметров: $\gamma = 0.1$, $\nu = 0.6$ $b=2$, $\rho = 0.5$, $\kappa = 0.5$}
\label{fig:m3}

\end{figure}

Положим  $\gamma = 0.1$, $\nu = 0.4$ $b=1$, $\rho = 0.1$, $\kappa = 0.1$ рисунок \ref{fig:m6}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{k01p01b1g01nu04.png}
\caption{Решение для параметров: $\gamma = 0.1$, $\nu = 0.4$ $b=1$, $\rho = 0.1$, $\kappa = 0.1$}
\label{fig:m6}

\end{figure}

Положим  $\gamma = 0.5$, $\nu = 0.4$ $b=0.9$, $\rho = 0.1$, $\kappa = 0.1$ рисунок \ref{fig:m4}.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.7\linewidth]{k01p01b09g05nu04.png}
\caption{Решение для параметров: $\gamma = 0.5$, $\nu = 0.4$ $b=0.9$, $\rho = 0.1$, $\kappa = 0.1$}
\label{fig:m4}

\end{figure}


\section{Оптимальное программное решение с применением алгоритма МРС}

Реализуем алгоритм MPC для задачи:
$$ J(z,u) = \int_0^\infty e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt, $$
\begin{equation}\label{ypp} \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t), \ u(t) \in [0,b-\varepsilon],
\end{equation}
$$z(0) = z_0.$$

В данной реализации $xtau$ состояние системы в измеряемый момент времени, $w0$ начальное приближение. Решаем систему для $tau \in [t0, T]$. В начале $tau = t0$:

\begin{lstlisting}

sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
\end{lstlisting}

Выделяем решение.

\begin{lstlisting}

xu = full(sol.x);
u_opt = reshape(xu(n+1:end), r, N);
J_opt = full(sol.f);
\end{lstlisting}

Ищем следующее состояние системы.

\begin{lstlisting}

res = F('x0', xtau, 'p', u_opt(1));
xtau = full(res.xf);
\end{lstlisting}

Запоминаем текущее управление и состояние $X$.

\begin{lstlisting}
U = [U u_opt(1)];
X = [X xtau];
\end{lstlisting}
Изменяем начальное приближение:
\begin{lstlisting}
w0 = [u_opt(2:end) zeros(1)]';
\end{lstlisting}

Переходим на $tau=tau+1$.



\section{Результаты численных экспериментов алгоритма МРС}

Рассмотрим различные решения задачи (\ref{ypp}) в зависимости от изменений параметров:
\begin{itemize}
\item $b$ -- размеры трудовых ресурсов,
\item $\gamma$ -- емкость абсорбции,
\item $\rho$ -- параметр дисконтирования,
\item $\nu$ -- рост научно-исследовательского сектора страны А,
\item $\kappa$ -- параметр эластичности замещения.
\end{itemize}
что-то похожее на правду

\begin{figure}[!h!]

\centering
\includegraphics[width=0.75\linewidth]{mpc100.png}
\caption{МРС c NMPC = 100}.
\label{fig:mpc11}

\end{figure}
\begin{figure}[!h!]

\centering
\includegraphics[width=0.75\linewidth]{a1b1c1.png}
\caption{МРС c NMPC = 100}.
\label{fig:mpc11}

\end{figure}
\begin{figure}[!h!]

\centering
\includegraphics[width=0.75\linewidth]{a4b2c6.png}
\caption{МРС c NMPC = 100}.
\label{fig:mpc11}

\end{figure}
\begin{figure}[!h!]

\centering
\includegraphics[width=0.75\linewidth]{a2b2c6.png}
\caption{МРС c NMPC = 100}.
\label{fig:mpc11}

\end{figure}

\bigskip

