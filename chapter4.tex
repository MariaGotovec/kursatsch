\chapter{ПРИМЕНЕНИЕ EMPC К РЕШЕНИЮ ЗАДАЧ И ОБ ОПТИМАЛЬНОМ РОСТЕ ТЕХНОЛОГИЧЕСКОГО ПОСЛЕДОВАТЕЛЯ}\label{chap4}

В настоящей главе применим метод EMPC к решению задачи об оптимальном росте технологического  последователя из главы 3. При этом рассмотрим три подхода:
\begin{enumerate}
  \item базовый EMPC без дополнительных ограничений (неограниченный EMPC)\cite{Grune};
  \item EPMC с терминальным ограничением-равенством \cite{Mayne};
  \item подход, в котором критерий качества дополняется специальной выбранной терминальной стоимостью.
\end{enumerate}
Последний подход --- новый, предлагается в данной работе впервые. Цель --- упростить задачу оптимального управления с точки зрения численного решения, поскольку задачи без жестких ограничений-равенств проще с вычислительной точки зрения. В главе проводится сравнение решений, полученных всеми тремя подходами, а также сравнение с решением задачи (\ref{redzou}) на основе Принципа максимума из главы \ref{chap2}.

\section{Прогнозирующие задачи оптимального управления}

В данной главе будем сравнивать результаты решения задачи об оптимальном росте технологического последователя методом ЕМРС с тремя различными прогнозирующими задачами. Ниже приводятся формулировки этих задач. Напомним, что прогнозирующие задачи в текущий момент $\tau$ имеют конечный горизонт управления $[\tau, \tau+T]$, а в качестве начального состояния для прогнозирующей модели выбирается текущее состояние, которое для редуцированной системы будет иметь вид $x(\tau)/y(\tau)$, где $x(\tau)$, $y(\tau)$ измеряемые текущие значения накопленных технологий стран $B$ и $A$, соответственно.

1) Прогнозирующая задача оптимального управления без дополнительных ограничений и терминальной стоимости, применяемая в так называемом неограниченном ЕМРС, имеет вид (см. \cite{Grune}):
$$
    I_1(z,u) = \int_\tau^{\tau+T}e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{41}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T].
    $$

Недостаток этого вида задачи состоит в том, что требуется достаточно длинный горизонт управления. Но даже несмотря на это, траектория замкнутой системы  может не выходить к магистрали и стабилизируется в окрестности некоторой точки. Увеличение горизонта, как правило, позволяет добиться того, чтобы траектория замкнутой системы асимптотически приближалась к магистрали. Однако, при этом заметно растет трудоемкость численного решения задачи оптимального управления (\ref{41}). Возможна ситуация, когда решение (\ref{41}) уже невозможно построить в реальном времени, т.е. за время, не превосходящее $h$.

2) Прогнозирующую задачу оптимального управления (\ref{41}) дополним терминальным ограничением-равенством:
$$
    I_2(z,u) = \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{42}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t),
\end{equation}
$$
z(\tau) = \frac{x(\tau)}{y(\tau)}, \ z(\tau+T)=z_1,
$$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
т.е. добавим $z_1=\frac{x_1}{y_1}$ требование, чтобы $z$ к моменту $\tau + T$ равнялась магистральному значению. Однако, вычислительные трудности не исчезают, может возникнуть ситуация, когда не существует ни одного допустимого управления, переводящего систему в состояние $z_1$.

3) В подходе, предлагаемом в данной дипломной работе дополним критерий качества задачи (\ref{41})  специально подобранной линейной (по фазовой переменной $z$) терминальной стоимостью:
$$
    I_3(z,u) =\alpha e^{-\rho(\tau+T) } z(\tau+T) + \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{43}
    \dot{z}(t)=u(t)(z(t)+\gamma) - \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
где $\alpha$ --- весовой коэффициент, выбор которого будет обоснован ниже.

\bigskip

В отличие от (\ref{42}) задача (\ref{43}) имеет решение при любом значении горизонта $T$. Далее в вычислительных экспериментах также покажем, что, в отличие от (\ref{41}), она обеспечивает асимптотическую устойчивость магистрали при небольших $T$.

\section{Оптимальное программное решение с применением Direct Single Shooting}

%Для реализации алгоритма МРС из раздела \ref{mpcu} необходимо на шаге 2 решать прогнозирующую задачу оптимального управления, т.е. находить программное решение задач (\ref{41}), (\ref{42}), (\ref{43}).
%
%Прогнозирующие задачи будут решаться численно с применением метода DSS из раздела 1.3, поэтому дальнейшее изложение будет посвящено программной реализации численных методов для решения задач (\ref{41}), (\ref{42}), (\ref{43}).
%
%Приведем реализацию в Matlab использованием CasADi для самой простой задачи, коей является (\ref{41}).
%Для начала зададим начальные условия:
%\begin{lstlisting}
%y0=1;
%x0=0.1;
%z0 = x0/y0;
%\end{lstlisting}
%Находим $z_1$, $p_1$ и проверяем какому случаю из таблицы \ref{tbll} соответствует задача с выбранными параметрами для этого создали функцию SteadyState. В ней мы находим $\beta_0,$ $\beta_1,$ $\beta_2$ и $z_1$:
%\begin{lstlisting}
%function [z_1,p_1] = SteadyState
%    beta0 = rho + nu - b;
%    beta1 = rho + nu - kappa*b;
%    beta2 = rho + kappa*nu - kappa*b;
%
%    if (beta0>0)  && (beta1>0) && (beta2>0) && (nu<b)
%        fprintf('A1B1C1\n');
%    end
%    if (beta0>0)  && (beta1<=0) && (beta2>0) && (nu<b)
%        fprintf('A1B1C2\n');
%    end
%    if (beta0>0)  && (beta1>0) && (beta2>0) && (nu>=b)
%        fprintf('A1B1C3\n');
%    end
%    if (beta0>0)  && (beta1<=0) && (beta2>0) && (nu>=b)
%        fprintf('A1B1C4\n');
%    end
%    if (beta0<0)  && (beta1>0) && (beta2>0)
%        fprintf('A1B1C7\n');
%    end
%    sol = fsolve(@(x) [phi_1(x(1),x(2));
%     phi_2(x(1),x(2))], [1;1]);
%    z_1 = sol(1); p_1 = sol(2);
%
%\end{lstlisting}
%Объявим переменные и параметры модели, с которыми будем работать:
%\begin{lstlisting}
% Переменные и параметры модели
%t = SX.sym('t');
%x1 = SX.sym('x1');
%u = SX.sym('u');
%xdot = (x1 + gamma)*u - nu*x1;
%
%\end{lstlisting}
%
%Подинтегральная функция критерия качества, так как у нас задача на максимум, а а встроенный алгоритм решает задачи на минимум в подынтегральную функцию возьмем с минусом:
%\begin{lstlisting}
%f0 = -exp(-rho*t)*(kappa*log(z1)+log(b-u));
%\end{lstlisting}
%
%Применим алгоритм Рунге-Кутты четвертого порядка для решения ОДУ:
%
%\begin{lstlisting}
%  DT = T/N;
%   f = Function('f', {x1, u, t}, {xdot, f0});
%   X0 = MX.sym('X0', n);
%   U = MX.sym('U');
%   tt = MX.sym('tt');
%   X = X0;
%   Q = 0;
%       [k1, k1_q] = f(X, U, tt);
%       [k2, k2_q] = f(X + DT/2 * k1, U, tt+DT/2);
%       [k3, k3_q] = f(X + DT/2 * k2, U,tt+DT/2);
%       [k4, k4_q] = f(X + DT * k3, U,tt+DT);
%       X=X+DT/6*(k1 +2*k2 +2*k3 +k4);
%       Q = Q + DT/6*(k1_q + 2*k2_q + 2*k3_q + k4_q);
%
%    F = Function('F', {X0, U, tt}, {X, Q},
%     {'x0','p','t'}, {'xf', 'qf'});
%
%\end{lstlisting}
%Собираем переменные и ограничения задачи (\ref{41}):
%  \begin{lstlisting}
%    u = MX.sym('u',N);
%    z = MX.sym('z',n);
%    J = 0;
%    G = [];
%    x = z;
%    for k = 1:N
%        res = F('x0', x, 'p', u(k), 't', (k-1)*DT);
%        x   = res.xf;
%         J   = J + res.qf;
%        \end{lstlisting}
%Для решения (\ref{42}) здесь добавляется:
%\begin{lstlisting}
%        g  = x-z_1;
%        \end{lstlisting}
%Для решения (\ref{43}) здесь добавляется:
%  \begin{lstlisting}
%        if k==N
%            J=J-exp(-rho*T)*p_1*x;
%        end
%    end
%\end{lstlisting}
%
%После формулировки задачи нелинейного программирования и ограничений, для решения задачи создается solver --- процедура решения, в данном случае -- на основе встроенного алгоритма IPOPT.
%
%\begin{lstlisting}
%nlp = struct('f', J, 'x', [z(:); u(:)], 'g', []);
%solver = nlpsol('solver', 'ipopt', nlp);
%
%lbw = zeros(N,r);
%ubw = (b-eps)*ones(N,r);
%w0 = zeros(N,r);
%xtau = z0;
%tic
%sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
%             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
%t_Elapsed = toc;
%\end{lstlisting}
%Восстанавливаем  управление:
%\begin{lstlisting}
%J_opt = full(sol.f);
%primal = full(sol.x);
%u_opt = reshape(primal(n+1:end), r, N);
%\end{lstlisting}
%Для восстановление двойственных переменных будет с помощью пи-системы:
%\begin{lstlisting}
%function [X,P] = PIsystem(T,x0,pT,ud)
%    ud = [ud ud(end)];
%    u = @(t) ud(floor(t/DT)+1);
%    sys_z = @(t,z) u(t)*(z+gamma) - nu*z;
%    sol_z = ode45(sys_z, T, x0, odeopt);
%    X = deval(sol_z,T);
%
%    sys_p = @(t,p) (rho+nu-u(t))*p - kappa/deval(sol_z,t);
%    sol_p = ode45(sys_p, flip(T), pT, odeopt);
%    P = deval(sol_p,T);
%end
%\end{lstlisting}
%Для восстановления двойственных переменных задачи (\ref{41}) передаем следующие параметры:
%\begin{lstlisting}
%[x_opt, p_opt] = PIsystem(0:DT:T, xtau, 0, u_opt);
%\end{lstlisting}
%
%Для задачи (\ref{42}) параметры для восстановления двойственных переменных выглядеть следующим образом:
%\begin{lstlisting}
%dual = exp(rho*DT*N)*abs(full(sol.lam_g));
%[x_opt, p_opt] = PIsystem(0:DT:T, xtau, dual, u_opt);
%\end{lstlisting}
%
%Для восстановления двойственных переменных задачи (\ref{43}) передаем следующие параметры:
%\begin{lstlisting}
%[x_opt, p_opt] = PIsystem(0:DT:T, xtau, p_1, u_opt);
%\end{lstlisting}
%
%Для вывода результата была написала функция results которая выводит графики:
%\begin{lstlisting}
%results(0:DT:T, x_opt, u_opt,p_opt, J_opt, t_Elapsed, 1)
%\end{lstlisting}
%
%В следующем разделе рассмотрим результаты работы приведенной реализаций.

\newpage
\section{Результаты численных экспериментов}

Рассмотрим различные решения задач (\ref{41})--(\ref{43}) в зависимости от изменений параметров:
\begin{itemize}
\item $b$ -- размеры трудовых ресурсов, пропорциональна размеру $L^B$ трудовых ресурсов страны-последователя,
\item $\gamma$ -- емкость абсорбции, т.к при описании параметрических областей, соответствующих всем реализуемым совмещенным случаям, не участвует емкость абсорбции $\gamma$ страны-последователя, изменение емкости абсорбции в пределах допустимого интервала (0,1) не меняет общую схему выбора страной-последователем оптимальной стратегии технологического роста в зависимости от начального соотношения $z_0$ запасов технологий.
\item $\rho$ -- параметр дисконтирования,
\item $\nu$ -- удельная скорость роста запаса технологий страны-лидера, линейно зависит от размера $L^A$ трудовых ресурсов страны-лидера,
\item $\kappa$ -- параметр эластичности замещения. При больших $\kappa$ значение эластичности замещения мало и наоборот, малые значения $\kappa$ соответствуют -- большим значениям значениям эластичности замещения.
\end{itemize}

Возможности страны-последователя описывают: $"$ресурсный$"$ параметр -- верхняя граница $b$ для значений управления и $"$информационный$"$ параметр -- емкость $\gamma$ абсорбции.

При соотношении параметров, отвечающих неособым невырожденным совмещенным случаям, схема выбора оптимального пути технологического развития для страны-последователя может быть выражена условной формулой: $"$начальный запас технологий мал по отношению к стране-лидеру (у $z_0$ малое значение) --- опережение с выравниванием, начальный запас технологий велик --- отставание с выравниванием$"$.
Опережение с выравниванием -- это оптимальный режим технологического развития страны-последователя, когда на старте процесса удельная скорость ее технологического роста, превосходит удельную скорость роста страны-лидера, она постепенно снижается, при этом все время больше $\nu$, в пределе на бесконечность сравнивается с $\nu$.

Полный экономический анализ ситуаций можно найти в работе \cite{Kryazhimski}. В настоящей работе нас будет в основном интересовать обоснование выбора прогнозирующей задачи для МРС в разд. 4.5.

Значения параметров при решении задач будем выбирать согласно таблице \ref{table_params}. В таблице указан случай  из таблицы \ref{tbll}, которому соответствует данный набор параметров, а также магистральные значения прямой $z_1$ и сопряженной $p_1$ переменных. Выбрано начальное состояние $z_0=0.1$ для всех решений.

\begin{table}
\caption{Значения параметров при решении задач (\ref{41})--(\ref{43})}\label{table_params}

\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline

  № & $\gamma$ & $\nu$ & $b$ & $\rho$ & $\kappa$  & $\beta_0$ & $\beta_1$ & $\beta_2$ & Случай & $z_1$ & $p_1$  \\

  \hline
     1 & 0.5 & 0.7 & 0.7 & 0.1 & 1.3  & 0.1 & -0.11 & 0.1 & А1В1С4 &  1.81 & 2.86 \\

    \hline

    2 &  0.3 & 0.3 & 0.3 & 0.14 & 0.5 & 0.14 & 0.29 & 0.14 & А1В1С3 &  0.13 & 11.11 \\
    \hline

    3 & 0.1 & 0.5 & 0.55 & 0.15 & 1.5 & 0.1 & -0.175 & 0.075 & А1В1С2 & 0.54 & 12.21 \\
    \hline

     4 & 0.3 & 0.3 & 0.4 & 0.14 & 0.5 &  0.04 & 0.24 & 0.09 & А1В1С1 &  0.23 & 6.99 \\
    \hline

     5 & 0.5 & 0.3 & 0.4 & 0.14 & 1 &  0.04 & 0.04 & 0.04 & А1В1С1 & 2 & 2.5 \\
    \hline

     6 & 0.5 & 0.3 & 0.5 & 0.14 & 0.05 &  -0.06 & 0.19 & 0.04 & А1В1С7 & 0.81 & 2.43 \\
    \hline

  \end{tabular}
\end{table}


На рисунках \ref{fig:sl1} -- \ref{fig:sl63} изображены полученные результаты для всех наборов параметров и всех трех рассматриваемых задач.
В таблице \ref{table_fig} представлено соответствие рисунков результатам решения задач (\ref{41})--(\ref{43}).

\begin{table}[!h]
\caption{Соответствие рисунков результатам решения задач (\ref{41})--(\ref{43})}\label{table_fig}

\centering
\begin{tabular}{|c|c|c|c|}
\hline

  №  &  задача (\ref{41}) &  задача (\ref{42}) &  задача (\ref{43})\\
  \hline
     1 & рис. \ref{fig:sl1} & рис. \ref{fig:sl12} & рис. \ref{fig:sl13}\\
  \hline
    2 & рис. \ref{fig:sl3} & рис. \ref{fig:sl32}& рис. \ref{fig:sl33}\\
    \hline
     3 & рис. \ref{fig:sl4} & рис. \ref{fig:sl42} & рис. \ref{fig:sl43}\\
     \hline
     4 & рис. \ref{fig:sl5} & рис. \ref{fig:sl52}& рис. \ref{fig:sl53} \\
     \hline
     5& рис. \ref{fig:sl8} & рис. \ref{fig:sl82}& рис. \ref{fig:sl83} \\
     \hline
     6& рис. \ref{fig:sl6} & рис. \ref{fig:sl62} & рис. \ref{fig:sl63} \\
     \hline

  \end{tabular}
\end{table}

На каждом рисунке изображены четыре графика. Они соответствуют:
\begin{itemize}
  \item оптимальному программному управлению;
  \item соответствующей оптимальной траектории;
  \item оптимальной котраектории;
  \item фазовому портрету гамильтоновой системы, где серая область --- множество $\Gamma_2$, на котором оптимальное управление равно нулю, красные штриховые кривые --- это особые направления, точка их пересечения --- особая точка ($z_1,p_1)$ (магистраль).
\end{itemize}

Далее проведем анализ полученных результатов для каждой задачи.

% рис 4.1 и 4.2
\begin{figure}[!h]
\centering
\includegraphics[width=0.9\linewidth]{1.png}
\caption{Набор параметров № 1, подход 1, случай А1В1С4}
\label{fig:sl1}

\centering
\includegraphics[width=0.9\linewidth]{5.png}
\caption{Набор параметров № 2, подход 1, случай А1В1С3, $\nu = b$}
\label{fig:sl3}

\end{figure}

\clearpage


% рис 4.3 и 4.4
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{3.png}
\caption{Набор параметров № 3, подход 1, случай А1В1С2}
\label{fig:sl4}

\centering

\includegraphics[width=0.9\linewidth]{4.png}
\caption{Набор параметров № 4, подход 1, случай А1В1С1}
\label{fig:sl5}

\end{figure}

\clearpage
% рис 4.5 и 4.6
\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{8.png}
\caption{Набор параметров № 5, подход 1, случай А1В1С1}
\label{fig:sl8}


\centering
\includegraphics[width=0.9\linewidth]{6.png}
\caption{Набор параметров № 6, подход 1, случай А1В1С7}
\label{fig:sl6}

\end{figure}

\clearpage

% рис 4.7, 4.8,
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{12.png}
\caption{Набор параметров № 1, подход 2, случай А1В1С4}
\label{fig:sl12}

\centering
\includegraphics[width=0.9\linewidth]{52.png}
\caption{Набор параметров № 2, подход 2, случай А1В1С3, $\nu = b$}
\label{fig:sl32}
\end{figure}
%4.9, 4.10
\clearpage
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{32.png}
\caption{Набор параметров № 3, подход 2, случай А1В1С2}
\label{fig:sl42}

\centering
\includegraphics[width=0.9\linewidth]{42.png}
\caption{Набор параметров № 4, подход 2, случай А1В1С1}
\label{fig:sl52}

\end{figure}

\clearpage
% рис 4.11 и 4.12
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{82.png}
\caption{Набор параметров № 5, подход 2, случай А1В1С1}
\label{fig:sl82}


\includegraphics[width=0.9\linewidth]{62.png}
\caption{Набор параметров № 6, подход 2, случайА1В1С7}
\label{fig:sl62}
\end{figure}

\clearpage
% Рис. 4.13, 4.14
\begin{figure}[!h!]

\centering
\includegraphics[width=0.9\linewidth]{13.png}
\caption{Набор параметров № 1, подход 3, случай А1В1С4}
\label{fig:sl13}

\centering
\includegraphics[width=0.9\linewidth]{53.png}
\caption{Набор параметров № 2, подход 3, случай А1В1С3, $\nu = b$}
\label{fig:sl33}
\end{figure}

\clearpage
% рис 4.15, 4.16
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{33.png}
\caption{Набор параметров № 3, подход 3, случай А1В1С2}
\label{fig:sl43}

\centering
\includegraphics[width=0.9\linewidth]{43.png}
\caption{Набор параметров № 4, подход 3, случай А1В1С1}
\label{fig:sl53}
\end{figure}
\clearpage
% рис 4.17, 4.18

\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{83.png}
\caption{Набор параметров № 5, подход 3, случай А1В1С1}
\label{fig:sl83}

\centering
\includegraphics[width=0.9\linewidth]{63.png}
\caption{Набор параметров № 6, подход 3, случай А1В1С7}
\label{fig:sl63}

\end{figure}

\clearpage
\subsection{Подход 1: Прогнозирующая задача для неограниченного EMPC}

Заметим, что все решения задачи (\ref{41}) обладают одной общей особенностью: оптимальная траектория является вогнутой, она сначала возрастает в направлении магистрального значения, а затем убывает. Насколько близко траектория подходит к магистральному значению, зависит от близости к нему начального состояния, которое во всех рассматриваемых случаях равно $z_0 = 0.1$ и оказывается меньше магистрального.

Заметим, что во всех случаях терминальное значение состояния $z(T)$ оказывается достаточно далеко от магистрали. При этом оптимальная котраектория в терминальный момент времени равна нулю:
$$
    p(T) = 0.
     $$

Напомним, что решение задачи получено с помощью прямых методов, которые сводят задачу оптимального управления к задаче нелинейного программирования. Тот факт, что значение сопряженной траектории в последний момент оказалось равным нулю во всех случаях сложно объяснить из задачи нелинейного программирования, но легко следует из  условий оптимальности для задачи (\ref{41}) в форме принципа максимума.

Эти условия имеют вид:
$$
    H(z^0(t),p^0(t),u^0(t)) = \max_{0\le u \le b-\varepsilon} H(z^0(t),p^0(t),u), \ \  t \in [0,T],
$$
где $p^0(t)$, $t \in [0,T]$, --- решение сопряженной системы
$$
    \dot{p}(t)= -(u^0(t)-\nu -\rho)p(t)-\frac{\kappa}{z^0(t)}
    $$
с условием трансверсальности $p(T)=0$.


С экономической точки зрения $p$ --- теневая цена ресурса. Условие трансверсальности означает, что к моменту $T$ отношение накопленных технологий теряет стоимость и его сохранение в окрестности равновесного значения нецелесообразно. Соответственно, часть промежутка $[0,T]$ тратится на то, чтобы экономика страны последователя "отстала"{}, а теневая цена упала до нуля. Эта ситуация всегда возникает, если на терминальное значение $z$ не накладывается ограничений и в критерии качества отсутствует слагаемое, которое зависит от значения $z$ в терминальный момент времени.

 Среднее время решения задачи 0.82 секунды.


\subsection{Подход 2: с терминальным ограничением}

Рассмотрим решения (\ref{42}), при тех же наборах параметров что и (\ref{41}). Решения представлены на рис. \ref{fig:sl12} -- \ref{fig:sl62}.

Как видно из рисунков, при добавлении в задачу терминального ограничения-равенства, решение в терминальный момент оказывается ближе к магистрали, а то и вовсе выходит в малую ее окрестность.

Значение сопряженной переменной в терминальный момент также не равно нулю, т.е. прямая переменная $z$ к концу управления не теряет свою стоимость. Тот же результат следует из условий оптимальности в форме принципа максимума, который для задачи (\ref{42}) имеет вид:
$$
    H(z^0(t),p^0(t),u^0(t)) = \max_{0\le u \le b-\varepsilon} H(z^0(t),p^0(t),u), \ \  t \in [0,T],
$$
где $p^0(t)$, $t \in [0,T]$, --- решение сопряженной системы
$$
    \dot{p}(t)= -(u^0(t)-\nu -\rho)p(t)-\frac{\kappa}{z^0(t)}
    $$
с условием трансверсальности $p(T)=\nu$. Здесь получается, что $\nu>0$ --- теневая цена в терминальный момент.

Участков убывания прямой траектории $z(t)$, $t\in [0,T]$, в решениях задачи (\ref{42}) не наблюдается. Однако, в среднем время решения задачи (\ref{42}) составляет 1.33 секунды, что на 61\% больше времени решения задачи (\ref{41}), и обусловлено наличием дополнительного жесткого ограничения-равенства.


\subsection{Подход 3: с терминальной стоимостью}

Решения задачи (\ref{43}), при тех же наборах параметров что и в (\ref{41}) -- (\ref{42}) приведены на рис. \ref{fig:sl13} -- \ref{fig:sl63}. В качестве значения параметра $\alpha$ выберем соответствующее магистральное значение $p_1$. Такой выбор обоснуем в разд. \ref{4sec:MPCres}.

Здесь условия оптимальности имеют вид
$$
    H(z^0(t),p^0(t),u^0(t)) = \max_{0\le u \le b-\varepsilon} H(z^0(t),p^0(t),u), \ \  t \in [0,T],
$$
где $p^0(t)$, $t \in [0,T]$, --- решение сопряженной системы
$$
    \dot{p}(t)= -(u^0(t)-\nu -\rho)p(t)-\frac{\kappa}{z^0(t)}
    $$
с условием трансверсальности
$$
    p(T)=\alpha = p_1.
    $$
Таким образом, в задаче (\ref{43}) сопряженная траектория в момент $T$ попадает в магистральное значение. Для сравнения, в предыдущей задаче (\ref{42}) прямая траектория попадает в магистральное значение. Это основное различие двух последних задач. Отметим, что в среднем время решения задачи  (\ref{43}) равно 1.07 сек., что меньше, чем у (\ref{42}).

Например, сравним фазовые графики для задач (\ref{41}), (\ref{42}), (\ref{43}) при параметрах (случай А1В1С2):
$$
    \gamma = 0.1, \ \nu = 0.5, \  b=0.55, \  \rho = 0.15, \ \kappa = 1.5, \ z_0=0.1.
    $$
Фазовые портреты приведены на  рис. \ref{fig:f1}--\ref{fig:f3}. Еще раз обратим внимание на тот факт, что использование задач (\ref{42}), (\ref{43}) позволяет к терминальному моменту привести траектории ближе к магистрали. Напомним, что магистраль $(z_1,p_1)$ находится на пересечении штриховых линий.

\begin{figure}[!h!]
\begin{center}
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f41.png}
\caption{Задача (\ref{41})}
\label{fig:f1} %% метка рисунка для ссылки на него
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f42.png}
\caption{Задача (\ref{42})}
\label{fig:f2}
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f43.png}
\caption{Задача (\ref{43})}
\label{fig:f3}
\end{minipage}
\end{center}
\end{figure}

Этот случай будем использовать для анализа сходимости схем МРС.

\section{Реализация алгоритма EМРС}
%
%
%Реализуем алгоритм EMPC для задач (\ref{41})-(\ref{43}), с использованием Direct Single Shooting из предыдущего раздела.
%
%В данной реализации xtau --- состояние системы в измеряемый момент времени, w0 --- начальное приближение для управления в момент $\tau +1$. В цикле по $\tau$ от 0 до Nmpc выполнить:
%
%\begin{lstlisting}
%
%sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
%             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
%\end{lstlisting}
%
%Выделяем решение.
%
%\begin{lstlisting}
%xu = full(sol.x);
%u_opt = reshape(xu(n+1:end), r, N);
%J_opt = full(sol.f);
%\end{lstlisting}
%
%Ищем следующее состояние системы.
%
%\begin{lstlisting}
%res = F('x0', xtau, 'p', u_opt(1));
%xtau = full(res.xf);
%\end{lstlisting}
%
%Запоминаем текущее управление и состояние $X$.
%
%\begin{lstlisting}
%U = [U u_opt(1)];
%X = [X xtau];
%\end{lstlisting}
%Изменяем начальное приближение:
%\begin{lstlisting}
%w0 = [u_opt(2:end) zeros(1)]';
%end;
%\end{lstlisting}
%
%В следующем разделе рассмотрим результаты работы приведенной реализации.

\section{Применение ЕМРС для решения задачи роста}\label{4sec:MPCres}

Для численного эксперимента возьмем набор параметров № 3:
$$
    \gamma = 0.1, \ \nu = 0.5, \  b = 0.55, \ \rho = 0.15,\ \kappa =1.5.
    $$
Тогда $z_1=0.54$, $p_1=12.21 $.

Выберем горизонт управления $T = 10$, и начальное состояние $z_0=0.1$. Для представления результатов будем останавливать алгоритм ЕМРС в момент времени $\tau = \text{Nmpc} = 50$.

\subsection{Подход 1: Неограниченный EMPC}

Решение задачи с применением базового алгоритма EMPC (неограниченного ЕМРС) на основе прогнозирующей задачи (\ref{41}), представлено на рис. \ref{fig:empc41}, где
\begin{itemize}
  \item на рисунке \ref{fig:empc41} а) штриховые линии соответствуют оптимальным программным решениям $z^0(t|x(\tau)),$ $t \in [\tau, \tau+T]$, задачи; сплошная линия --- реализующаяся траектория замкнутой системы;
  \item на рисунке \ref{fig:empc41} б) представлена реализация $u^*(t)$, $t\in [0, 50]$;
  \item на рисунке \ref{fig:empc41} в) --- траектория замкнутой системы на фазовой плоскости гамильтоновой системы.
\end{itemize}

\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc41.png}
\caption{Результаты ЕМРС с прогнозирующей задачей (\ref{41})}
\label{fig:empc41}
\end{figure}


Напомним, что оптимальные траектории задачи (\ref{41}) имеют продолжительные участки убывания --- на рисунке \ref{fig:empc41} а) они видны в виде ряда убывающих штриховых линий. Это означает, что значительная (около половины) часть промежутка управления тратится на участок, на котором траектория удаляется от магистрального значения. В результате траектория замкнутой системы $z^*(t)$, $t\ge 0$ не выходит на магистраль (сплошная линия на рис. а)), а лишь достигает значения 0.422.

При увеличении Nmpc в 2 раза (Nmpc = 100) траектория замкнутой системы достигает лишь значения 0.432.

Из работ Л.Грюне (см., например, \cite{Grune}) известно, что  добиться требуемого поведения замкнутой системы (асимптотической устойчивости в случае стабилизации, или удовлетворения магистрального свойства для ЕМРС)  можно при достаточно больших значениях горизонта управления $T$. Нижнюю оценку на $T$ можно найти согласно \cite{Grune}.

В настоящей работе для задачи (\ref{41}) экспериментальным путем установлено, что для того, чтобы траектория начала достигать окрестности магистрали, нужно выбрать значение $T = 30$. При этом для сохранения точности численного решения задачи оптимального управления необходимо выбрать $N=150$ (чтобы период квантования для дискретизации сохранился). В результате время решения прогнозирующей задачи существенно возрастает и в среднем составляет 5.87 сек., что в 7.15 раз превышает среднее время решения задачи при $T=10$.

\subsection{Подход 2: EMPC с ограничениями-равенствами}


На рисунке \ref{fig:empc42} представлены результаты решения задачи методом EPMC с использованием прогнозирующей задачи с терминальным ограничением-равенством (\ref{42}).
\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc42.png}
\caption{Результаты ЕМРС с прогнозирующей задачей (\ref{42})}
\label{fig:empc42}
\end{figure}

Как ожидалось из анализа программных решений,  функции $z^0(t|x(\tau))$, $t \in [\tau, \tau+T]$, при всех $\tau$ являются возрастающими. Траектории замкнутой системы и значения управления стремятся к магистральным значениям. Как следует из результатов теории МРС (глава 2), это требование всегда выполняется при условии, что задача (\ref{42}) имеет решение в позиции $(0, z_0)$.

Следует отметить, что указанное условие является достаточно жестким:
возможны такие наборы параметров $T$, $z_0$, при которых задача (\ref{42}) недопустима, т.е. не существует ни одного допустимого управления, переводящего систему в состояние $z_1$.

В рассматриваемой задаче экспериментально установлено, что при $T \le 6$ решения задачи   (\ref{42}) не существует.

Таким образом, применение ЕМРС с использованием прогнозирующей задачи с терминальным ограничением-равенством (\ref{42}) имеет два недостатка:
\begin{itemize}
\item  трудоемкость решения задачи (\ref{42}),
\item  начальная недопустимость задачи с ограничением-равенством.
\end{itemize}

Далее покажем, что эти недостатки устраняет подход 3.

\subsection{Подход 3: EMPC с терминальной стоимостью}


Решение задачи  методом EPMC с использованием прогнозирующей задачи с терминальной стоимостью (\ref{43}) представлено на рис.  \ref{fig:empc43}.

\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc43.png}
\caption{Результаты решения задачи (\ref{43})}
\label{fig:empc43}
\end{figure}

Как и ожидалось из анализа программных решения, участки убывания функций $z^0(t|x(\tau))$, $t \in [\tau, \tau+T]$, в сравнении с задачей (\ref{41}) значительно сократились. Траектории замкнутой системы и значения управления стремятся к магистральным значениям.

Как следует из решения задач (\ref{41}), (\ref{42}), а также с точки зрения реализации алгоритмов в реальном времени и трудоемкости решения прогнозирующих задач, желательно иметь как можно меньший горизонт управления и не включать в задачу терминальные ограничения. Задача (\ref{43}) удовлетворяет этим требованиям. Важное свойство --- она имеет решение при любом горизонте $T$.

Алгоритм ЕМРС на основе задачи (\ref{43}) также был реализован при $T=5$. Напомним, что задача (\ref{42}) при таком значении горизонта управления не имеет решения, а задача (\ref{41}) не позволяет асимптотически достичь магистрали. Задача (\ref{43}), напротив, позволяет достичь магистрали и удовлетворить практическим требованиям --- время решения прогнозирующей задачи в среднем составило 0.545 сек.

Обоснуем теперь выбор значения $\alpha$ --- параметра в терминальной стоимости в задаче (\ref{43}).

Рассмотрим общую прогнозирующую задачу для ЕМРС с терминальной стоимостью в виде
\begin{equation}\label{Ptau}
    \min_{u} \int^{\tau+T}_\tau L(x(t),u(t))dt + W(x(\tau+T)),
\end{equation}
при условиях
$$
    \dot{x}(t)=f(x(t),u(t)),\   x(\tau)=x_\tau,
    $$
$$
    u(t) \in U, \ x(t) \in X, \ t\in [\tau,\tau+T].
    $$


Для того, чтобы выбрать подходящую терминальную стоимость $W$, рассмотрим гамильтонову систему для  прогнозирующей задачи оптимального управления в общем виде (\ref{Ptau}):
\begin{equation}\label{4pi-sys}
    \dot{p} =-(\partial f(x(t),u(t))/\partial x)^Tp(t)+\partial L(x(t),u(t))/\partial x,
    \end{equation}
$$
    \dot{x}(t) = f(x(t),u(t)), t \in[\tau,\tau+T].
    $$

Предполагаем, что задача (\ref{Ptau}) имеет магистраль, с магистральными значениями $(x_1, u_1, p_1)$. Управление $u(t)\equiv u_1$, $t\in [\tau, \tau+T]$, соответствующая ему прямая траектория $x(t)\equiv x_1$, $t\in [\tau, \tau+T]$, и сопряженная траектория $p(t) \equiv p_1$, $t\in [\tau, \tau+T]$, является решением гамильтоновой системы принципа максимума при начальном условии $x(\tau)=x_1$, и условии трансверсальности $p(\tau+T)=p_1$.

Для того, чтобы получить в прогнозирующей задаче  условие трансверсальности
$$
    p(\tau+T)=p_1,
    $$
выберем линейную терминальную стоимость $W(x)=p_1^Tx$.

Тогда в общей задаче на минимум (\ref{Ptau}):
$$
    p(\tau+T)\equiv -\partial W(z(\tau+T))/\partial x = p_1.
    $$

Естественно, нас интересует нахождение магистрального значения $p_1$ без решения задачи оптимального управления, точно так же, как магистральное значение $(x_1, u_1)$ находилось из задачи нелинейного программирования (\ref{23}):
$$
    L(x,u)\rightarrow \min,
    $$
$$
    f (x,u)=0,
    $$
$$
    u \in U, \ x \in X.
$$


Запишем условия оптимальности (условия Каруша-Куна-Таккера --- ККТ \cite{Boyd}) для задачи нелинейного программирования (\ref{23}). Ограничения $u \in U$, $x \in X$ опустим, поскольку чаще всего ($x_1,u_1) \in $ int $ X\times U$. Условия имеют вид:
$$
    \partial L(x,u)/\partial x+(\partial f(x,u)/\partial x)^T\lambda=0,
    $$
$$
    f(x,u)=0.
    $$
Этим условиям необходимо удовлетворяет пара ($z_1,u_1$) вместе с некоторым (оптимальным) множителем Лагранжа $\lambda_1$.

Теперь рассмотрим гамильтонову систему (\ref{4pi-sys}) на магистральных значениях. Очевидно, что на стационарных значениях $(x_1, u_1, p_1)$ правая часть гамильтоновой системы равна нулю, т.е. имеем
$$
    -(\partial f(z_1,u_1)/\partial x)^Tp_1+\partial L(z_1,u_1)/\partial x = 0,
    $$
$$
    f(z_1,u_1) = 0.
    $$
Сравнивая с условиями ККТ, устанавливаем, что $p_1 = -\lambda_1$.

Таким образом,
$$
    W(x)=-\lambda_1^Tx.
    $$


В случае задачи оптимального экономического роста, в которой критерий качества содержит дисконтирование, критерий качества максимизируется, магистраль находится из условий (\ref{nveq})--(\ref{veq}), терминальная стоимость также содержит дисконтирующий множитель:
$$
    W(z(\tau+T))=e^{-\rho(\tau+T)}p_1 z(\tau +T).
    $$

\bigskip

Таким образом, из трех исследованных прогнозирующих задач, задача (\ref{43}):
\begin{itemize} 
\item имеет решение при любом значении горизонта $T$, даже при малых значениях, что предпочтительно при применении численных методов (в отличие от задачи (\ref{42}));
\item  обеспечивает асимтотический выход траекторий замкнутой системы к магистрали при небольших горизонтах $T$ (в отличие от задачи (\ref{42})).
    \end{itemize}
Кроме того, в работе предложен простой подход к выбору терминальной стоимости в задаче (\ref{43}). Для этого нужно только  решить задачу нелинейного программирования (\ref{23}) и найти соответствующий оптимальному решению множитель Лагранжа.


%выводы???
%Рассмотрим набор параметров 1. При приближении $\gamma$ к допустимой верхней границе (единице) предельное отношение технологических запасов ($\overline{z}$) двух стран стремится к вполне определенной конечной верхней границе, и наоборот при приближении емкости абсорбции $\gamma$ страны-последователя к нулю предел технологических запасов страны-последователя и страны-лидера стремится к нулю. Эти эффекты, выполняются при относительной малости трудовых ресурсов страны-последователя, чаще всего это значит выполнение  $b \leq \nu$.
%
%Значит, при $"$краткосрочной$"$ ориентации пути технологического развития потенциально мощная страна-последователь, выравниваясь в перспективе со страной-лидером по скорости технологического роста, начинает катастрофически отставать от нее по запасу накопленных технологий.
%
%Рассмотрим набор параметров 5. В этом решении примечательно то, что страна-последователь накопит в два раза больше технологий, чем страна-лидер.
%Страна-последователь, при оптимальном развитии, может расти в технологическом отношении быстрее, при опережении с выравниванием.
%
%Рассмотрим набор параметров 6. В отличии от других неособых невырожденных совмещенных случаев, А1В1С7 предполагает $\beta_0<0$, это можно трактовать как то, что трудовой ресурс $b$ страны-последователя мал в сравнении с трудовым ресурсом страны-лидера. В то же время неравенства $\beta_1 >0,\ \beta_2 >0$ накладывают верхние ограничения на ресурс страны-последователя. Таким образом, при малом трудовой ресурсе страны-последователя, оптимальный режим ее роста характеризуется для неособых невырожденных совмещенных случаев также как говорилось ранее: $"$малый начальный запас технологий -- опережение с выравниванием, наоборот -- отставание с выравниванием$"$.
%
%Рассмотрев ситуации, когда трудовые ресурсы страны-последователя относительно велики, т.е $b>\nu$. Изменения оптимального режима технологического роста страны-последователя при изменении ее параметра $\rho$ дисконтирования от нуля до бесконечности. Близость $\rho$ к нулю может толковаться так: страна-последователь следует пути $"$долгосрочного планирования$"$. В противном случае, большие значения параметра дисконтирования означают, что страна-последователь следует пути "краткосрочного планирования". 