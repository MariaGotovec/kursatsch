\chapter{УПРАВЛЕНИЕ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ}\label{chap3}

В этой главе описывается метод управления по прогнозирующей модели -- МРС (Model Predictive control)\cite{Fontes}, для построение управления обратной связи нелинейных систем.
Описываются основные свойства и алгоритм построения стратегии МРС.
\section{Управление по прогнозирующей модели}\label{mpcu}
Рассмотрим нелинейный объект управления с ограничением на управляющее воздействие, поведение которого при $s \ge t$ описывается следующей математической моделью:
\begin{equation}\label{exg}
\dot{x}(s)=f(x(s),u(s),s), \ x(t)=x_t,
\end{equation}
$$
u(s) \in U(s), \  s\geq t.
$$

В модели (\ref{exg}) которой считаются заданными:
\begin{itemize}
\item множество $ X_0 \subset \R^n$, содержащий все возможные начальные состояния объекта управления в начальный момент времени $t_0$,
\item $n$-вектор $x_t$ (для $t \geq t_0$ ), который описывает состояние физического объекта в момент времени $t$,
\item функция $f: \R^n \times \R^r \times \R \rightarrow \R^n$, обеспечивающая существование и единственность решений $x(s)$ уравнения (\ref{exg}) при любых кусочно-непрерывных управлениях $u(s) \ s \ge t$ и начальных состояниях $x(t) \in X_0$,
\item множество допустимых управлений $U(t) \subseteq \R^r$.
    \end{itemize}

Предположим, что система (\ref{exg}) асимптотически управляема на $X_0$.

Цель управления объектом состоит в том построить обратную связь которая переводит объект в начало координат (в асимптотическом смысле). Одним из популярных подходов для достижения поставленной цели является стратегия МРС.


Выберем фиксированную сетку $0 = t_0 < t_1 <... <t_N = t_f, \  i = \overline{0, N}$ с шагом $\delta$.
Обратная связь (стратегия МРС) строится на основе решения в каждый момент времени $t_i$. Задача оптимального управления:

 \begin{equation}\label{mzou} P (t_i , x_{t_i} ,T)=\int^{t+T}_t L(x(s),u(s), s)ds + W(t+T,x(t+T)),
\end{equation}
при условиях:
$$\dot{x}(s)=f(x(s),u(s), s), s\geq [t,t+T],$$
$$x(t)=x_t,$$
$$u(s) \in U(s),$$
$$x(t+T) \in S,$$
где переменной $t$ обозначается текущий момент времени, в то время как $s$ используется для обозначения переменной времени в модели прогнозирования. Вектор $x_t$ обозначает состояние объекта, в момент времени $t$. Процесс $(x, u)$ представляет собой пару решения системы. Пара$(\bar{x}, \bar{u})$ обозначает наше оптимальное решение для разомкнутого контура задачи оптимального управления. Пара $(x^* , u^* )$ является замкнутым контуром траектории и управления в стратегии MPC.

Решение задачи (\ref{mzou}) является множество допустимых пар $(x, u)$, содержащие измеримую функцию управления $u$ и непрерывную траекторию состояния $x$, которые удовлетворяют ограничениям $P (t_i , x_{t_i} ,T)$. Задача считается решаемой если существует хотя бы одно допустимое решение. Пара $(\bar{x}, \bar{u})$ называется решением $P (t_i , x_{t_i} ,T)$, если он является глобальным минимумом (\ref{mzou}) среди всех пар.

Параметрами МРС-метода (параметрами настройки) являются параметры задачи оптимального управления, которые не связаны с системой управления. Понятно, что здесь они представлены:
\begin{enumerate}
  \item горизонтом управления $T$;
  \item функции текущих и конечных затрат
$L$ и $W$;
  \item набором терминальных ограничений $S \subset \R^n$.
\end{enumerate}

Алгоритм MPC заключается в выполнении следующих шагов в определенный момент времени $t_i$:
\begin{enumerate}
  \item Измерение текущего состояния объекта $x_{t_i}$.
  \item Вычисление управления обратной связи - это программное управление, решение задачи оптимального управления в виде функции времени $\bar{u}$: $[t_i , t_{i + T}] \rightarrow \R^n$ для задачи $P (t_i , x_{t_i} ,T)$.
  \item Управление $u^* (t): = \bar{u} (t)$ на интервале$[t_i , t_{i}+\delta]$ применяется к объекту, (оставшийся управление $\bar{u} (t)$, $t \geq t_i + \delta$ отбрасывается).
  \item Процедура повторяется, как показано на рисунке (\ref{fig:mpc}), для следующего момента $t_{i + 1}$ (индекс $i$ увеличивается на одну единицу).
\end{enumerate}
\begin{figure}[!h!]

\centering
\includegraphics[width=0.5\linewidth]{MPCstat.png}
\caption{Стратегия MPC}
\label{fig:mpc}

\end{figure}
Результирующее управления является управлением обратной связи, так как в течение каждого интервала выборки управление $u^*$ определяется от состояния $x_{t_i}$.

Для фиксированного конечного горизонта замкнутая траектория системы $x^*$ не обязательно совпадают с траекторией разомкнутого контура решения задачи оптимального управления $\bar{x}$. Следовательно, нет гарантии, что MPC приведет к устойчивости замкнутой системы и сильно зависит от параметров настройки стратегии MPC.

Можно гарантировать (\ref{mzou}) устойчивость замкнутого контура, выбирая параметры настройки, удовлетворяющие определенному условию устойчивости. Важнейшим элементом условия устойчивости является требование, чтобы параметры настройки были выбраны в такими, что для всех состояний $x$, принадлежащих множеству возможных конечных состояний задачи оптимального управления (то есть, подмножество $S$), существует такое значение $\tilde{u}$:
\begin{equation}\label{www1}
  W_x (x) \cdot f (x, \tilde{u}, t)\leq -L (x, \tilde{u}, t).
\end{equation}


Это условие важно для определения того, что некоторая функция $V^{\delta}$, построенная из функций значения вовлеченных ЗОУ «уменьшается». Затем, используя аргументы типа Ляпунова, для доказательства устойчивости замкнутой системы. Определили, что если $W$ --- контрольная функция Ляпунова (следовательно, удовлетворяющая условию (\ref{www1}) для $S = \R^n$), тогда устойчивость может быть достигнута. Устойчивость другой MPC-задачи можно проверить с помощью (\ref{www1}). Важным следствием является то, что это обобщение позволяет нам строить схемы MPC гарантируя устойчивость для новых классов нелинейных систем.

  \begin{assumption}\label{p1} Для всех $t\in \R^n$ множество $U (t)$ содержит начало координат,и $f ( 0, 0, t) = 0$. \end{assumption}
   \begin{assumption}\label{p2} Функция $f$ непрерывна, и $x \mapsto f ( x, u, t)$ локально дифференцируема для каждой пары $(t, u)$.\end{assumption}
   \begin{assumption}\label{p3} Множество $U (t)$ компактно для всех $t$ и для каждой пары $(t, x)$ множество $f (x, U (t), t)$ выпукло.\end{assumption}
   \begin{assumption}\label{p4} Функция $f$ компактна на компакте $x$ точнее, для любого компакта $X \subset \R^n$ ,множество $\{\|f (x, u, t)\|, \  t \in \R, \  x \in X, \  u \in U (t)\}$ компакт.\end{assumption}


Предположение (\ref{p1}) не рассматривается как ограничивающее, так как большинство систем возможно построить, чтобы удовлетворять ему после изменения координат. Предположение (\ref{p3}) и (\ref{p2}) необходимы чтобы гарантировать существование решения ЗОУ. Условия предположения (\ref{p4}) автоматически выполняются для инвариантных по времени систем, так как образ компактного множества для непрерывной функции компактны.

Основной результат устойчивости утверждает, что управление обратной связи в результате применение стратегии MPC является стабилизирующим управлением, при условии, что параметры настройки удовлетворяют условиям устойчивости ниже. Рассмотрим следующее условия устойчивости: в системе (\ref{exg}) параметры настройки: горизонт планирования $T$, целевые функции $L$ и $W$ и терминальное множество ограничений $S$ должны удовлетворять следующим условиям:

\begin{enumerate}
  \item Множество $S$ замкнуто и содержит начало координат.
  \item Функция $L$ непрерывна, $L (\cdot, 0, 0) = 0$,и есть непрерывное положительно определенное неограниченная функция $M$: $\R^n \rightarrow \R_+$ такая что $L (t, x, u) \geq M (x)$ для всех $(t, u) \in \R \times \R^r$ . Более того, «расширенное множество скоростей»$\{(v, l) \in \R^n \times \R_+$ $: v = f (t, x, u)$, $l \geq L (t, x, u)$, $u \in U (t)\}$ является выпуклым для всех $(t, x)$.

  \item Функция $W$ положительно полуопределена и непрерывно дифференцируема.
  \item Временной горизонт $T$ таков, что множество $S$ достижимо за время $T$ из любого начального состояния и из любой точки в сгенерированных траекториях: что есть множество $X$, содержащее $X_0$ такое, что для каждой пары $(t_0 , x_0 ) \in \R \times X$ существует управление $u: [t_0 , t_0 + T] \rightarrow \R^m$, удовлетворяющие
$$x (t_0 + T; t_0 , x_0 , u) \in S.$$Кроме того, для всех функций управления и в условии: $$x (t; t_0 , x_0 , u) \in X \  \forall t \in [t_0 , t_0 + T].$$

  \item Существует скаляр $\epsilon > 0$ такой, что для каждого времени $t \in [T, \infty)$ и каждого $x_t \in S$, мы можем выбрать функцию управления $\tilde{u}: [t, t + \epsilon] \rightarrow \R^m$ , причем $\tilde{u} (s) \in U (s)$ для всех $s \in [t, t + \epsilon]$, удовлетворяющих

 \begin{equation}\label{5a}
W_t (t, x_t ) + W_x (t, x_t )\cdot f (t, x_t , \tilde{u} (t))\leq -L (t, x_t , \tilde{u} (t)),
\end{equation}
 а также
\begin{equation}\label{5b}
  х (t + r; t, x_t , \tilde{u}) \in S, \  r \in [0, \epsilon].
\end{equation}


\end{enumerate}

 \begin{assumption} Допустим выполняются предположения (\ref{p1} – \ref{p4}). Предположим также, что параметры настройки удовлетворяют условиям устойчивости. Тогда для любого $(t_0 , x_0 ) \in \R \times X_0$ решения открытого цикла существует задача оптимального управления $P (t_0 , x_0 , T)$.

Рассмотрим последовательность пар ${t_i , x_i}$ такую, что $x_i$ --- значение в момент времени $t_i$ решения траектории $P (t_{i - 1} , x_{i - 1} , T)$. Тогда решение $P (t_i , x_i , T)$ для всех $i \geq 1$ также существует. Кроме того, построенная MPC траектория $x^*$ имеет конечный временной интервал.
 \end{assumption}
Основной результат по устойчивости заключается в следующем.

\begin{theorem}. Предположим, что выполняются предположения (\ref{p1} – \ref{p4}). Выберите параметры настройки, чтобы удовлетворить SC, Тогда для достаточно малого времени между выборками $\delta$, система с обратной связью в результате применения стратегии MPC асимптотически устойчиво $ \parallel x^* (t)\parallel \rightarrow 0$ при $t \rightarrow \infty$.\end{theorem}

 \begin{remark} Условия устойчивости 1, необходимы чтобы гарантировать существование решения задачи оптимального управления обратной связи. Первая часть условия условий устойчивости 2 и условия условий устойчивости 3 тривиально удовлетворяются для обычной квадратичной задачи функция $L (x, u) = x^T Qx + u^T Ru,$ для $Q> 0$ и $R \geq 0$ и $W (x) = x^T Px$, при $P \geq 0$. Вторая часть условия устойчивости 2 о выпуклости «расширенной скорости набора» --- это общеизвестное требование существования решения в ЗОУ с интегральным критерием. Учитывая (\ref{p3}), оно автоматически выполняется, если $L$ выпуклая и $f$ линейно зависима от $u$, или если $L$ не зависит от $u$. Последнее является следствием как $f (x, U (t), t)$, так и ${l: l \geq L (t, x)}$ - выпуклые множества.

Условие устойчивости 4 необходимо, чтобы гарантировать существование допустимого процесса в последовательности ЗОУ. В предположениях(\ref{p1}-\ref{p4}) не было утверждения о целесообразности ЗОУ. Эти предположения могут быть использованы в первоначальном тесте на адекватность метода, так как они включают только данные модели системы, которая, как правило, моделируется или имеет мало свободы для изменения. На более позднем этапе моделирования можно попытаться удовлетворить желаемым свойствам осуществимости и устойчивости с помощью выбора соответствующих параметров настройки. Условие (\ref{5a}) является ключевым требованием для установления существование «убывающей» ляпуновоподобной функциии, из этого следует асимптотическая устойчивость. Это может быть представлено как существованием элемента управления, который управляет состояниями к внутренним уровням наборов $W$ со скоростью $L$. В случае квадратичных функций $W$ множества уровней с центром в начале координат и вектор скорости должены указывать внутрь. Тем не менее, $W$ не нужно повторно ограничивать квадратичными функциями, и эта свобода может использоваться в наших интересах. Условие (\ref{5b}) просто утверждает, что траектория связанный с $\tilde{u}$ не покидает множество $S$ сразу.
\end{remark}


\bigskip
