\chapter{УПРАВЛЕНИЕ ПО ПРОГНОЗИРУЮЩЕЙ МОДЕЛИ}\label{chap3}

В этой главе описываются основные положения теории управления по прогнозирующей модели --- МРС (Model Predictive control)\cite{Fontes, Grune}. МРС --- это один из современных подходов к построению управлений типа обратной связи (МРС-регулятора) в задачах управления линейными и нелинейными системами с ограничениями. Методы МРС получили широкое распространение на практике благодаря простоте реализации, возможности учитывать ограничения на управляющие и фазовые переменные, требования к качеству процессов, нелинейности систем.

В настоящей главе описывается основной алгоритм построения МРС-регулятора, некоторые подходы к обеспечению устойчивости системы, замкнутой построенной обратной связью, и модификация, которая носит название экономического МРС --- ЕМРС (Economic MPC).


\section{Основные положения теории МРС}\label{mpcu}

Рассмотрим нелинейный объект управления с ограничениями на управляющие воздействия, поведение которого при $s \ge t$ описывается (прогнозируется, предсказывается) следующей математической моделью:
\begin{equation}\label{exg}
\dot{x}(s)=f(x(s),u(s),s), \  x(t)=x_t,
\end{equation}
$$
u(s) \in U(s), \  s\geq t,
$$
где, как и ранее, $x(s)\in \R^n$, $u(s)\in \R^r$ --- состояния и управления модели (\ref{exg}).


В модели (\ref{exg}) считаются заданными:
\begin{itemize}
\item множество $X_0 \subset \R^n$, содержащее все возможные начальные состояния объекта управления в начальный момент времени $t_0$ ($t\ge t_0$);

\item $n$-вектор $x_t$ (при $t \geq t_0$ ), который описывает состояние физического объекта в момент времени $t$;

\item функция $f: \R^n \times \R^r \times \R \rightarrow \R^n$, обеспечивающая существование и единственность решений $x(s)$, $s \ge t$, уравнения (\ref{exg}) при любых кусочно-непрерывных управлениях $u(s)$,  $s \ge t$, и начальных состояниях $x_t \in X_0$;

\item множества допустимых управлений $U(t) \subseteq \R^r$, $t\ge t_0$.
    \end{itemize}

Предположим, что система (\ref{exg}) асимптотически управляема \cite{Grune} на $X_0$.


Относительно параметров прогнозирующей модели сделаем следующие предположения

  \begin{assumption}\label{p1} Для всех $t\in \R$ множество $U (t)$ содержит начало координат и $f ( 0, 0, t) = 0$, $t\ge t_0$. \end{assumption}

   \begin{assumption}\label{p2} Функция $f$ непрерывна по своим аргументам и удовлетворяет условию Липшица по переменной $x$ для любой фиксированной пары $(t,u)$.\end{assumption}

   \begin{assumption}\label{p3} Множество $U (t)$ компактно для всех $t$ и для каждой пары $(t, x)$ множество $f (x, U (t), t)$ выпукло.\end{assumption}

   \begin{assumption}\label{p4} Для любого компакта $X \subset \R^n$, множество $\{\|f (x, u, t)\|, \  t \in \R, \  x \in X, \  u \in U (t)\}$ --- компакт.\end{assumption}


Предположение \ref{p1} не является ограничительным, поскольку его можно удовлетворить заменой переменных системы. Предположения \ref{p2} и \ref{p3} необходимы для того, чтобы гарантировать существование решения задачи оптимального управления для системы (\ref{exg}). Условия предположения (\ref{p4}) автоматически выполняются для стационарных систем, так как образ компактного множества для непрерывной функции компактен.



Цель управления объектом, представленным математической моделью (\ref{exg}), состоит в том, чтобы построить управление типа обратной связи (обратную связь), которое переводит объект в начало координат (в асимптотическом смысле), т.е. $x_t\to 0$, $t\to +\infty$. Одним из популярных подходов для достижения поставленной цели является  МРС-регулятор.


Для достижения указанной цели будем использовать методы МРС.

Выберем горизонт управления $T>0$ и зададим фиксированную сетку $0 = t_0 < t_1 <... $, с шагом $\delta$ ($0<\delta<T$), т.е. $t_i = t_0 + i\delta$, $i = 0, 1, 2,\ldots$. Обратная связь (стратегия МРС) строится на основе решения в каждый момент времени $t_i$ так называемой \textit{прогнозирующей задачи оптимального управления} на конечном промежутке времени $[t_i, t_i+T]$:
\begin{equation}\label{mzou}
{\cal P} (t, x_{t}, T) = \int^{t+T}_t L(x(s),u(s), s)ds + W(t+T,x(t+T)),
\end{equation}
при условиях
$$
    \dot{x}(s)=f(x(s),u(s), s),\   x(t)=x_t,
    $$
$$
    u(s) \in U(s), \ s\in [t,t+T],
    $$
$$
    x(t+T) \in S,
    $$
где  $t$ обозначает реальное физическое время, $t_i$ --- текущий момент времени, в то время как $s$ используется для обозначения переменной времени в прогнозирующей модели. Как уже отмечалось выше, вектор $x_t$ обозначает состояние объекта в момент времени $t$.

Понятия допустимого и оптимального управления в задаче оптимального управления (\ref{mzou}) вводятся стандартно (см. главу 1). Класс управляющих воздействий, в котором рассматривается задача (\ref{mzou}) может быть классом измеримых, кусочно-непрерывных функций или дискретных управляющих воздействий, т.е. таких функций, что
$$
    u(t_k) \equiv u(s), \ s\in [t_k, t_k +\delta].
    $$
Теоретические результаты ниже получены в \cite{Fontes} для измеримых функций. Однако, принимая во внимание тот факт, что прогнозирующая задача, как правило, требует решения с привлечением вычислительных методов, при реализации алгоритмов МРС разумно принять класс дискретных управляющих воздействий. Условия, которые необходимо заменить в \cite{Fontes} для учета данной особенности, будут приведены ниже.


Параметрами МРС-регулятора (параметрами настройки) являются параметры задачи оптимального управления, которые не связаны с системой управления. Понятно, что здесь они представлены:
\begin{enumerate}
  \item горизонтом управления $T$;
  \item функциями текущей и конечной (терминальной) стоимостей $L$ и $W$;
  \item терминальным множеством $S \subset \R^n$.
\end{enumerate}

Алгоритм MPC заключается в выполнении следующих шагов для каждого момент времени $t_i$, $i=0, 1,2, \ldots$:
\begin{enumerate}
  \item Измеряется текущего состояния объекта $x_{t_i}$.
  \item Вычисляется оптимального (программного) управления $u^0(t)$, $t\in [t_i , t_{i} + T]$, --- решения задачи оптимального управления ${\cal P} (t_i , x_{t_i} ,T)$.
  \item Управление $u^* (t): = u^0(t)$ при  $t\in [t_i , t_{i}+\delta]$ подается на вход объекта управления (остальные значения оптимального программного управления $u^0(t)$, $t \geq t_i + \delta$ отбрасываются либо используются в качестве начальных приближений в следующий момент $t_i+\delta$).
  \item Процедура повторяется для следующего момента $t_{i+1}$.
  \end{enumerate}

На рис.~\ref{fig:mpc} приведена иллюстрация описанного выше алгоритма.
\begin{figure}[!h!]

\centering
\includegraphics[width=0.5\linewidth]{MPCstat.png}
\caption{Стратегия MPC}
\label{fig:mpc}

\end{figure}

В результате применения алгоритма МРС будет получено управление, которое является управлением типа обратной связи, поскольку в течение каждого интервала $[t_i, t_i+\delta]$ управление $u^*(t) = u^*(t| x_{t_i})$ определяется, как функция состояния $x_{t_i}$.

Для фиксированного конечного горизонта $T$ траектория замкнутой  системы не обязательно совпадают с траекторией разомкнутого контура --- решением прогнозирующей задачи оптимального управления $x^0(s)$, $s\in [t_i, t_i+T]$. Следовательно, нет гарантии, что MPC-регулятор обеспечит устойчивость замкнутой системы. На самом деле свойство устойчивости значительно зависит  от перечисленных выше параметров настройки алгоритма MPC.

Условия на параметры задачи (\ref{mzou}), гарантирующие устойчивость замкнутого контура, будем называть условиями устойчивости. Обсудим их в следующем разделе.

\section{Условия устойчивости}

В работе \cite{Fontes} приведены обобщающие условия устойчивости, которым удовлетворяют все предложенные до сих пор алгоритмы МРС, построенные на основе прогнозирующих  задач вида (\ref{mzou}).



Основной результат работы \cite{Fontes} утверждает, что обратная связь, полученная в результате применения стратегии MPC, является стабилизирующей при условии, что горизонт планирования $T$, функции стоимостей $L$ и $W$ и терминальное множество ограничений $S$ удовлетворяют следующим условиям устойчивости:

\begin{enumerate}
  \item Множество $S$ замкнуто и содержит начало координат.
  \item Функция $L$ непрерывна, $L (\cdot, 0, 0) = 0$, и существует непрерывная положительно определенная неограниченная функция $M$: $\R^n \rightarrow \R_+$, такая что $L (t, x, u) \geq M (x)$ для всех $(t, u) \in \R \times \R^r$ . Более того, «расширенное множество скоростей» $\{(v, l) \in \R^n \times \R_+$ $: v = f (t, x, u)$, $l \geq L (t, x, u)$, $u \in U (t)\}$ является выпуклым при любых $(t, x)$.

  \item Функция $W$ положительно полуопределена и непрерывно дифференцируема.

  \item Временной горизонт $T$ таков, что множество $S$ достижимо за время $T$ из любого начального состояния и из любой точки в сгенерированных траекториях, т.е. существует множество $X \supseteq X_0$, такое что для каждой пары $(t_0 , x_0 ) \in \R \times X$ существует управляющее воздействие $u(t)$, $ t\in [t_0 , t_0 + T]$, переводящее модель (\ref{exg}) на терминальное множество $S$:
      $$
        x (t_0 + T| t_0 , x_0 , u) \in S,
      $$
      при этом траектории не покидают множества $X$:
      $$
        x (t| t_0 , x_0 , u) \in X, \   t \in [t_0 , t_0 + T].
        $$

  \item Существует скаляр $\epsilon > 0$ такой, что при любых $t \in [T, \infty)$ и  $x_t \in S$, найдется управляющее воздействие $\tilde{u}(s)\in U(s)$, $s\in [t, t + \epsilon]$, удовлетворяющее условию
\begin{equation}\label{5a}
    W_t (t, x_t ) + W_x (t, x_t)\cdot f (t, x_t , \tilde{u} (t))\leq -L (t, x_t , \tilde{u} (t)),
\end{equation}
 а также
\begin{equation}\label{5b}
  x(t + r| t, x_t , \tilde{u}) \in S, \  r \in [0, \epsilon].
\end{equation}


\end{enumerate}

Обсудим приведенные условия.  Условия  1 необходимы для того, чтобы гарантировать существование решения прогнозирующей задачи оптимального управления. Первая часть условий устойчивости 2 и условия  3 тривиально удовлетворяются для  квадратичных функций стоимости $L (x, u) = x^T Qx + u^T Ru$ и $W (x) = x^T Px$, где $Q> 0$ и $R, P \geq 0$. Вторая часть условия устойчивости 2 о выпуклости «расширенного множества скоростей» --- это общеизвестное требование существования решения в задаче оптимального управления с интегральным критерием. Учитывая \ref{p3}, оно автоматически выполняется, если $L$ выпуклая и $f$ линейна по $u$, или если $L$ не зависит от $u$. Последнее является следствием того, что  $f (x, U (t), t)$ и ${l: l \geq L (t, x)}$ --- выпуклые множества.

Условие устойчивости 4 необходимо, чтобы гарантировать существование допустимого управляющего воздействия в последовательности прогнозирующих задач оптимального управления. В предположениях \ref{p1}--\ref{p4} не было утверждения о допустимости этих задач. Эти предположения могут быть использованы априори для проверки реализуемости алгоритма МРС, так как они включают только параметры математической модели объекта. На более позднем этапе, при построении прогнозирующих задач, можно попытаться удовлетворить желаемым свойствам допустимости и устойчивости с помощью выбора соответствующих параметров настройки.

Условие (\ref{5a}) является важнейшим элементом условий устойчивости. Оно требует, чтобы для всех состояний $x$, принадлежащих терминальному множеству  $S$, существовало значение управления $\tilde{u}$ такое, что выполняется неравенство (\ref{5a}), которое интерпретируется как существование управления, который переводит систему к внутренним множествам уровня $W$ со скоростью $L$. В случае квадратичных функций $W$, их множества уровня --- эллипсоиды с центром в начале координат, и вектор скорости должен указывать внутрь. Условие (\ref{5b}) просто утверждает, что траектория связанный с $\tilde{u}$ не покидает множество $S$ сразу. Условие (\ref{5a}) используется при доказательстве того факта, что некоторая функция $V^{\delta}$, построенная по оптимальным значениям прогнозирующих задач оптимального управления «уменьшается». Тогда используя аргументы  Ляпунова, удается  доказать устойчивость замкнутой системы.


\bigskip

Приведем важный результат, гарантирующий, что алгоритм МРС реализуем, т.е. в каждый момент $t_i$, $i = 0,1, \ldots$, найдется решение соответствующей прогнозирующей задачи, будет найдено нужное значение обратной связи для подачи его на объект управления.

\begin{proposition}\cite{Fontes}
    Пусть выполняются предположения \ref{p1} – \ref{p4} и параметры настройки удовлетворяют условиям устойчивости 1--5. Тогда для любого $(t_0 , x_0 ) \in \R \times X_0$  задача оптимального управления ${\cal P} (t_0 , x_0 , T)$ имеет решение.

    Рассмотрим последовательность позиций $(t_i , x_i)$ такую, что $x_i = x^0(t_i|t_{i-1},x_{i - 1},u^0)$ --- значение в момент времени $t_i$ оптимальной траектории ${\cal P} (t_{i - 1}, x_{i - 1}, T)$. Тогда решение ${\cal P} (t_i , x_i , T)$ для всех $i \geq 1$ также существует.

    Кроме того, построенная алгоритмом MPC траектория продолжима вправо при всех $t\ge t_0$.
\end{proposition}\label{prop1}

Утверждение \ref{prop1} в литературе называют результатом о \textit{начальной и рекуррентной допустимости} прогнозирующих задач оптимального управления.

Доказательство этого факта достаточно тривиально. Поскольку выполняются предположения \ref{p1} – \ref{p4}, и существует допустимое управление, переводящее систему (\ref{exg}) на терминальное множество $S$ (согласно условию 4), то задача ${\cal P} (t_0 , x_0 , T)$ удовлетворяет известным теоремам существования решений в задачах оптимального управления в классе измеримых управляющих воздействий. Далее, при $x_i = x^0(t_i|t_{i-1},x_{i - 1},u^0)$ в задаче ${\cal P} (t_i , x_i , T)$ выберем управляющее воздействие $u(t) = u^0(t)$, $t\in [t_i, t_i+T-\delta]$, и дополним его на промежутке $[t_i+T-\delta, t_i+T]$ управлением $\tilde u$, о котором идет речь в условии 5. Построенное управляющее воздействие допустимо в задаче ${\cal P} (t_i , x_i , T)$, поскольку оно удовлетворяет всем ограничениям задачи. Снова прибегая к условиям существования решений в задачах оптимального управления, получим, что оптимальное программное управление в задаче ${\cal P} (t_i , x_i , T)$ существует.

Если прогнозирующие задачи оптимального управления ${\cal P} (t_i , x_i , T)$ решаются в классе дискретных управляющих воздействий, то, как было описано в главе 1, они фактически сводятся к задачам нелинейного программирования. Соответственно, предположения \ref{p1} – \ref{p4} ослабляются таким образом, чтобы задача нелинейного программирования имела решение, а начальная допустимость задачи ${\cal P} (t_0 , x_0 , T)$ выводится в одно из основных требований условий устойчивости.

\bigskip

Основной результат по устойчивости дает следующая

\begin{theorem} \cite{Fontes} Предположим, что выполняются предположения (\ref{p1} – \ref{p4}), а параметры настройки удовлетворяют условиям устойчивости 1--5. Тогда для достаточно периода квантования $\delta$  система, замкнутая обратной связью MPC, асимптотически устойчива в том смысле, что $ \|x^* (t)\| \rightarrow 0$ при $t \rightarrow \infty$.\end{theorem}

\section{Экономический МРС}
В последние годы фокус исследований в рамках MPC сместился в сторону приложений, в которых экономика процесса (минимизация энергетических затрат, максимизация выпуска, прибыли) важнее стабилизации некоторого заданного положения равновесия. Новое направление в теории MPC получило название экономического MPC – Economic Model Predictive Control (EMPC). В силу основных свойств EМРС, естественной областью его применения являются задачи экономического роста, динамические задачи микро- и макроэкономики, задачи оптимизации портфелей.

В экономическом МРС функция $L$, задается экономическими требованиями к процессу управления, тогда условие $L(x_1,u_1)\leq L(x,u)$, как правило, не выполняется.
Точка $(x_1, u_1)$ -- магистраль - определяется из задачи нелинейного программирования \cite{Grune}

$$
L(x,u)\rightarrow \min, \ f(x,u)=0, \ u \in U, \ x \in X.
$$

Базовый алгоритм ЕМРС повторяет приведенный выше:следующих шагов для каждого момент времени $t_i$, $i=0, 1,2, \ldots$ решается задача (\ref{mzou}) и первое значение ее оптимального программного управления подается на вход объекта (\ref{exg}) до поступления следующего измерения состояния в момент  $t_i+1$. Однако, из-за нарушения предположений относительно стоимости этапа $L$ стандартные рассуждения доказательства устойчивости оказываются неприменимы. Модификация проводится с использованием теории диссипативности динамических систем.

Как и в случае задачи стабилизации, использование прогнозирующей задачи (\ref{mzou}) без дополнительных требований может привести к тому, что траектория замкнутой системы в асимптотике не достигает магистрали. 