\chapter{МРС}\label{chap3}



\section{МРС}\label{mpcu}
Рассмотрим нелинейный объект управления с ограничением на управляющее воздействие, поведение которого при $s \ge t$ описывается следующей математической моделью:
\begin{equation}\label{exg}
\dot{x}(s)=f(x(s),u(s),s), \ x(t)=x_t,
\end{equation}
$$
u(s) \in U(s), \  s\geq t.
$$

В модели (\ref{exg}) которой считаются заданными:
\begin{itemize}
\item множество $ X_0 \subset \R^n$, содержащий все возможные начальные состояния объекта управления в начальный момент времени $t_0$,
\item $n$-вектор $x_t$ (для $t \geq t_0$ ), который описывает состояние физического объекта в момент времени $t$,
\item функция $f: \R^n \times \R^r \times \R \rightarrow \R^n$, обеспечивающая существование и единственность решений $x(s)$ уравнения (\ref{exg}) при любых кусочно-непрерывных управлениях $u(s) \ s \ge t$ и начальных состояниях $x(t) \in X_0$,
\item множество допустимых управлений $U(t) \subseteq \R^r$.
    \end{itemize}

Предположим, что система (\ref{exg}) асимптотически управляема на $X_0$.

Цель управления объектом состоит в том построить обратную связь которая переводит объект в начало координат (в асимптотическом смысле). Одним из популярных подходов для достижения поставленной цели является стратегия МРС.


Выберем фиксированную сетку $0 = t_0 < t_1 <... <t_N = t_f, \  i = \overline{0, N}$ с шагом $\delta$.
Обратная связь (стратегия МРС) строиться на основе решения в каждый момент времени $t_i$. Задача оптимального управления:

 \begin{equation}\label{mzou} P (t_i , x_{t_i} ,T)=\int^{t+T}_t L(x(s),u(s), s)ds + W(t+T,x(t+T)),
\end{equation}
при условии:
$$\dot{x}(s)=f(x(s),u(s), s), s\geq [t,t+T],$$
$$x(t)=x_t$$
$$u(s) \in U(s).$$
$$x(t+T) \in S$$.

Где переменной $t$ обозначается текущий момент времени, в то время как $s$ используется для обозначения переменной времени в модели прогнозирования. Вектор $x_t$ обозначает фактическое состояние объекта, в момент времени $t$. Процесс $(x, u)$ представляет собой пару решения системы. Пара$(\bar{x}, \bar{u})$ обозначает наше оптимальное решение для разомкнутого контура задачи оптимального управления. Пара $(x^* , u^* )$ является замкнутым контуром траектории и управления в стратегии MPC.

Решение задачи (\ref{mzou}) является множество допустимых пар $(x, u)$, содержащие измеримую функцию управления $u$ и непрерывную траекторию состояния $x$, которые удовлетворяют ограничениям $P (t_i , x_{t_i} ,T)$. Задача считается решаемой если существует хотя бы один допустимое решение. Пара $(\bar{x}, \bar{u})$ называется решением $P (t_i , x_{t_i} ,T)$, если он является глобальным минимумом (\ref{mzou}) среди всех пар.


\textbf{!!!!!!не знаю как перевести след предложение}
We call \emph{design parameters}
the variables present in the open-loop optimal control
problem that are not from the system model (i.e. variables we are able to choose); these comprise the time
horizon $T$, the running and terminal costs functions
$L$ and $W$, and the terminal constraint set $S \subset \R^n$

Алгоритм MPC заключается в выполнении следующих шагов в определенный момент времени $t_i$:
\begin{enumerate}
  \item Измерение текущего состояния объекта $x_{t_i}$.
  \item Вычисление оптимальное управление обратной связи $\bar{u}$: $[t_i , t_{i + T}] \rightarrow \R^n$ для задачи $P (t_i , x_{t_i} ,T)$.
  \item Управление $u^* (t): = \bar{u} (t)$ на интервале$[t_i , t_{i}+\delta]$ применяется к объекту, (оставшийся управление $\bar{u} (t)$, $t \geq t_i + \delta$ отбрасывается).
  \item Процедура повторяется показано на рисунке (\ref{fig:mpc}) для следующего момента $t_{i + 1}$ (индекс $i$ увеличивается на одну единицу).
\end{enumerate}
\begin{figure}[!h!]

\centering
\includegraphics[width=0.5\linewidth]{MPCstat.png}
\caption{Стратегия MPC}
\label{fig:mpc}

\end{figure}
Результирующее управления является управлением обратной связи, так как в течение каждого интервала выборки управление $u^*$ определяется от состояния $x_{t_i}$.

Для фиксированного конечного горизонта замкнутая траектория системы $(x^*)$ не обязательно совпадают с траекторией разомкнутого контура $(\bar{x})$ решения задачи оптимального управления. Следовательно, нет гарантии, что MPC приведет к стабилизации замкнутой системы и сильно зависит от design parameters стратегии MPC.

Можно гарантировать стабильность результата замкнутой системы, выбирая design parameters, удовлетворяющие определенному условию устойчивости. Важнейшим элементом условия устойчивости является требование, чтобы design parameters были выбраны в такими, что для всех состояний $х$, принадлежащих множеству возможных конечных состояний задачи оптимального управления (то есть, подмножество $S$), существует такое значение $\tilde{u}$ , что
\begin{equation}\label{www1}
  W_x (x) \cdot f (x, \tilde{u}, t)\leq -L (x, \tilde{u}, t)
\end{equation}.


Это условие важно для определения того, что некоторая функция $V^{\delta}$, построенная из функций значения вовлеченных ЗОУ «уменьшается». Затем, используя аргументы типа Ляпунова, для доказательства устойчивость замкнутой системы. Определили, что если $W$ - контрольная функция Ляпунова (следовательно, удовлетворяющая условие (\ref{www1}) для $S = \R^n$ ), тогда стабильность может быть достигнуты. Здесь мы также показываем, как стабильность других MPC схемы можно проверить с помощью (\ref{www1}). Важным следствием является то, что это обобщение позволяет нам строить схемы MPC гарантируя стабильность для новых важных классов нелинейных систем.

  \begin{assumption}\label{p1} Для всех $t\in \R^n$ множество $U (t)$ содержит начало координат,и $f ( 0, 0, t) = 0$. \end{assumption}
   \begin{assumption}\label{p2} Функция $f$ непрерывна, и $x \mapsto f ( x, u, t)$ локально липшицева непрерывна для каждой пары $(t, u)$.\end{assumption}
   \begin{assumption}\label{p3} Множество $U (t)$ компактно для всех $t$ и для каждой пары $(t, x)$ множество $f (x, U (t), t)$ выпукло.\end{assumption}
   \begin{assumption}\label{p4} Функция $f$ компактна на компакте $x$ точнее, для любого компакта $X \subset \R^n$ ,множество ${f ( x, u, t): t \in \R, x \in X, u \in U (t)}$ компакт.\end{assumption}


Предположение (\ref{p1}) не должно рассматриваться как ограничивающее,так как большинство систем может быть построено, чтобы удовлетворять ему после соответствующее изменение координат. Предположение (\ref{p3}) и (\ref{p1}) необходимы чтобы гарантировать существование решения ЗОУ. Условия предположения (\ref{p4}) автоматически выполняются для инвариантных по времени системы, так как образ компактного множества для непрерывной функции компактны.

Основной результат устойчивости утверждает, что управление обратной связи в результате применение стратегии MPC является стабилизирующим управлением, при условии, что design parameters удовлетворяют условиям устойчивости ниже. Рассмотрим следующее условия устойчивости: в системе (\ref{exg}) design parameters: горизонт планирования $T$, целевые функции $L$ и $W$ и терминальное множество ограничений $S$ должны удовлетворять следующим условиям:

\begin{enumerate}
  \item Множество $S$ замкнуто и содержит начало координат.
  \item Функция $L$ непрерывна, $L (\cdot, 0, 0) = 0$,и есть непрерывное положительно определенное неограниченная функция $M$: $\R^n \rightarrow \R_+$ такая что $L (t, x, u) \geq M (x)$ для всех $(t, u) \in \R \times \R^r$ . Более того, «расширенное множество скоростей»{$(v, l) \in \R^n \times \R_+$ $: v = f (t, x, u)$, $l \geq L (t, x, u)$, $u \in U (t)$} является выпуклым для всех $(t, x)$.

  \item Функция $W$ положительно полуопределена и непрерывно дифференцируема.
  \item Временной горизонт $T$ таков, что множество $S$ достижимо за время $T$ из любого начального состояния и из любой точки в сгенерированных траекториях: что есть множество $X$, содержащее $X_0$ такое, что для каждой пары $(t_0 , x_0 ) \in \R \times X$ существует управление $u: [t_0 , t_0 + T] \rightarrow \R^m$, удовлетворяющие
$$x (t_0 + T; t_0 , x_0 , u) \in S$$.Кроме того, для всех функций управления и в условии над $$x (t; t_0 , x_0 , u) \in X \  \forall t \in [t_0 , t_0 + T].$$

  \item Существует скаляр $\epsilon > 0$ такой, что для каждого времени $t \in [T, \infty)$ и каждого $x_t \in S$, мы можем выбрать функцию управления $\tilde{u}: [t, t + \epsilon] \rightarrow \R^m$ , причем $\tilde{u} (s) \in U (s)$ для всех $s \in [t, t + \epsilon]$, удовлетворяющих

 \begin{equation}\label{5a}
W_t (t, x_t ) + W_x (t, x_t )\cdot f (t, x_t , \tilde{u} (t))\leq -L (t, x_t , \tilde{u} (t))
\end{equation}
 а также
\begin{equation}\label{5b}
  х (t + r; t, x_t , \tilde{u}) \in S, \  r \in [0, \epsilon]
\end{equation}


\end{enumerate}

 \begin{assumption} Допустим выполняется (\ref{p1} – \ref{p4}). Предположим также, что design parameters удовлетворяют условиям устойчивости. Тогда для любого $(t_0 , x_0 ) \in \R \times X_0$ решение открытого цикла существует задача оптимального управления $P (t_0 , x$0 , T).

Рассмотрим последовательность пар ${t_i , x_i} $такую, что $x_i$ - значение в момент времени $t_i$ решения траектории $P (t_{i - 1} , x_{i - 1} , T)$. Тогда решение $P (t_i , x_i , T)$ для всех $i \geq 1$ также существует. Кроме того, построенная MPC траектория $x^*$ имеет конечный временной интервал.
 \end{assumption}
Основной результат по устойчивости заключается в следующем.

\begin{theorem}. Предположим, что выполняются предположения (\ref{p1} – \ref{p4}). Выберите design parameters, чтобы удовлетворить SC, Тогда для достаточно малого времени между выборками $\delta$,система с обратной связью в результате применения стратегии MPC асимптотически устойчив $ \parallel x^* (t)\parallel \rightarrow 0$ при $t \rightarrow \infty$.\end{theorem}

 \begin{remark} Условий устойчивости 1, чтобы набор $S$ закрыт необходимо гарантировать существование решения задачи оптимального управления обратной связи. Первая часть условия условий устойчивости 2 и условия условий устойчивости 3 тривиально удовлетворяются для обычной квадратичной задачи функция $L (x, u) = x^T Qx + u^T Ru,$ для $Q> 0$ и $R \geq 0$ и $W (x) = x^T Px$, при $P \geq 0$. Вторая часть SC2 о выпуклости «расширенной скорости набора »- это общеизвестное требование существования решения в ЗОУ с интегральным критерием. Учитывая (\ref{p3}),оно автоматически выполняется, если $L$ выпуклая и $f$ линейно зависима от $u$, или если $L$ не зависит от $u$.Последнее является следствием как $f (x, U (t), t)$, так и${l: l \geq L (t, x)}$ - выпуклые множества.

Условие устойчивости 4 необходимо, чтобы гарантировать существование допустимого процесса в последовательности ЗОУ. В предположения   (\ref{p1}-\ref{p4}) не было утверждения о целесообразности ЗОУ. Эти предположения могут быть использованы в первоначальном тесте на адекватность метода, так как они включают только данные модели системы, которая, как правило,моделируется или имеет мало свободы для изменения. На более позднем этапе моделирования можно попытаться удовлетворить желаемым свойствам осуществимости и стабильности соответствующим выбором design parameters. Условие (\ref{5a}) является ключевым требованием для установления существование «убывающей» ляпуновоподобной функциии, из этого следует асимптотическая устойчивость. Это может быть представлено как существованием элемента управления, который управляет состояниями к внутренним уровням наборов $W$ со скоростью $L$. В случае квадратичных функций $W$ множества уровней липоиды с центром в начале координат и вектор скорости должены указывать внутрь. Тем не менее, $W$ не нужно повторно ограничивать квадратичными функциями, и эта свобода может использоваться в наших интересах. Условие (\ref{5b}) просто утверждает, что траектория связанный с $\tilde{u}$ не покидает множество $S$ сразу.
\end{remark}

\section{Оптимальное программное решение}

Реализуем алгоритм MPC для задачи:
$$
J(x,u)=\int_0^z e^{-\rho t} [\kappa  ln x(t)+ln(b - u(t))]dt \rightarrow \max,
$$
$$
\dot{x}(t) = u(t)(x(t) + \gamma y(t)),
$$ \begin{equation}\label{ch3}x(0) = x_0,
\end{equation}
$$
\dot{y}(t) = \nu y(t), $$
$$ y(0) = y_0,  u(t) \in [0, b-\varepsilon].
$$

В данной реализации $xtau$ состояние системы в измеряемый момент времени, $w0$ начальное приближение. Решаем систему для $tau \in [t0, T]$. В начале $tau = t0$:

\begin{lstlisting}

sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
\end{lstlisting}      
 
Выделяем решение.
             
\begin{lstlisting}
 
xu = full(sol.x);
u_opt = reshape(xu(n+1:end), r, N);
J_opt = full(sol.f);
\end{lstlisting}

Ищем следующее состояние системы.

\begin{lstlisting}

res = F('x0', xtau, 'p', u_opt(1));
xtau = full(res.xf);
\end{lstlisting}

Запоминаем текущее управление и состояние $X$.

\begin{lstlisting}
U = [U u_opt(1)];
X = [X xtau];
\end{lstlisting}
Изменяем начальное приближение:
\begin{lstlisting}
w0 = [u_opt(2:end) zeros(1)]';
\end{lstlisting}

Переходим на $tau=tau+1$.

\section{Результаты численных экспериментов}
Сравним результаты решения задачи (\ref{ch3}) с помощью алгоритма МРС и решение задачи нелинейного программирования с помощью Direct Single Shooting. При равных параметрах:

\begin{itemize}
\item $b$ -- размеры трудовых ресурсов,
\item $\gamma$ -- емкость абсорбции,
\item $\rho$ -- параметр дисконтирования,
\item $\nu$ -- рост научно-исследовательского сектора страны А,
\item $\kappa$ -- параметр эластичности замещения.
\end{itemize}

Пусть начальное количество технологий страны лидера($y_0$) в три раза превышает страны последователя($x_0$).
Положим $\gamma = 0.1$, $\nu = 0.6$ $b=1$, $\rho = 0.5$, $\kappa = 0.9$.

\begin{figure}[!h!]

\centering
\includegraphics[width=0.8\linewidth]{1sT3V06B1P05K09XY13g01.png}
\caption{Решение задачи нелинейного программирования с помощью Direct Single Shooting}
\label{fig:mpsdss1}

\end{figure}

\begin{figure}[!h!]

\centering
\includegraphics[width=0.8\linewidth]{mpc1.png}
\caption{Решение задачи с помощью алгоритма МРС}.
\label{fig:mpsdss2}

\end{figure}
Из графиков на рисунках \ref{fig:mpsdss1} и  \ref{fig:mpsdss2} можно сделать вывод, что управление получаемое с помощью МРС является более эффективным, так как система не переходит в стационарное состояние, а продолжает свой рост.

Сравним управления на рисунках \ref{fig:mpsdss3} и  \ref{fig:mpsdss4} :
\begin{figure}[!h!]

\centering
\includegraphics[width=0.8\linewidth]{udss.png}
\caption{Управление из решения задачи нелинейного программирования с помощью Direct Single Shooting}
\label{fig:mpsdss3}

\end{figure}

\begin{figure}[!h!]

\centering
\includegraphics[width=0.8\linewidth]{umpc.png}
\caption{Управление из решения задачи с помощью алгоритма МРС}.
\label{fig:mpsdss4}

\end{figure}

\bigskip
