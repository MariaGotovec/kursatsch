\chapter{ПРИМЕНЕНИЕ EMPC К РЕШЕНИЮ ЗАДАЧ И ОБ ОПТИМАЛЬНОМ РОСТЕ ТЕХНОЛОГИЧЕСКОГО ПОСЛЕДОВАТЕЛЯ}\label{chap4}

В настоящей главе применим метод EMPC к решению задачи об оптимальном росте технологического  последователя из главы 3. При этом рассмотрим три подхода:
\begin{enumerate}
  \item базовый EMPC без дополнительных ограничений (неограниченный EMPC)\cite{Grune};
  \item EPMC с терминальным ограничением-равенством [x];
  \item подход, в котором критерий качества дополняется специальной выбранной терминальной стоимостью.
\end{enumerate}
Последний подход --- новый, предлагается в данной работе впервые. Цель --- упростить задачу оптимального управления с точки зрения численного решения, поскольку задачи без жестких ограничений-равенств проще с вычислительной точки зрения. В главе проводится сравнение решений, полученных всеми тремя подходами, а также сравнение с решением задачи (\ref{redzou}) на основе Принципа максимума из главы \ref{chap2}.

\section{Прогнозирующие задачи оптимального управления}

В данной главе будем сравнивать результаты решения задачи об оптимальном росте технологического последователя методом ЕМРС с тремя различными прогнозирующими задачами. Ниже приводятся формулировки этих задач. Напомним, что прогнозирующие задачи в текущий момент $\tau$ имеют конечный горизонт управления $[\tau, \tau+T]$, а в качестве начального состояния для прогнозирующей модели выбирается текущее состояние, которое для редуцированной системы будет иметь вид $x(\tau)/y(\tau)$, где $x(\tau)$, $y(\tau)$ измеряемые текущие значения накопленных технологий стран $B$ и $A$, соответственно.

1) Прогнозирующая задача оптимального управления без дополнительных ограничений и терминальной стоимости, применяемая в так называемом неограниченном ЕМРС, имеет вид (см. \cite{Grune}):
$$
    I_1(z,u) = \int_\tau^{\tau+T}e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{41}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T].
    $$

Недостаток этого вида задачи состоит в том, что требуется достаточно длинный горизонт управления. Но даже несмотря на это, траектория замкнутой системы  может не выходить к магистрали и стабилизируется в окрестности некоторой точки. Увеличение горизонта, как правило, позволяет добиться того, чтобы траектория замкнутой системы асимптотически приближалась к магистрали. Однако, при этом заметно растет трудоемкость численного решения задачи оптимального управления (\ref{41}). Возможна ситуация, когда решение (\ref{41}) уже невозможно построить в реальном времени, т.е. за время, не превосходящее $h$.

2) Прогнозирующую задачу оптимального управления (\ref{41}) дополним терминальным ограничением-равенством:
$$
    I_2(z,u) = \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{42}
    \dot{z}(t)=u(t)(z(t)+\gamma)- \nu z(t),
\end{equation}
$$
z(\tau) = \frac{x(\tau)}{y(\tau)}, \ z(\tau+T)=z_1,
$$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
т.е. добавим $z_1=\frac{x_1}{y_1}$ требование, чтобы $z$ к моменту $\tau + T$ равнялась магистральному значению. Однако, вычислительные трудности не исчезают, может возникнуть ситуация, когда не существует ни одного допустимого управления, переводящего систему в состояние $z_1$.

3) В подходе, предлагаемом в данной дипломной работе дополним критерий качества задачи (\ref{41})  специально подобранной линейной (по фазовой переменной $z$) терминальной стоимостью:
$$
    I_3(z,u) =\alpha e^{-\rho(\tau+T) } z(\tau+T) + \int_t^{t+T} e^{-\rho t} [\kappa  \ln z(t) + \ln (b-u(t))]dt\rightarrow\max,
    $$
\begin{equation}\label{43}
    \dot{z}(t)=u(t)(z(t)+\gamma) - \nu z(t), \
\end{equation}
$$
    z(\tau) = \frac{x(\tau)}{y(\tau)},
    $$
$$
    u(t) \in [0,b-\varepsilon], \ t\in[\tau,\tau+T],
    $$
где $\alpha$ --- весовой коэффициент, выбор которого будет обоснован ниже.

\bigskip

В отличие от (\ref{42}) задача (\ref{43}) имеет решение при любом значении горизонта $T$. Далее в вычислительных экспериментах также покажем, что, в отличие от (\ref{41}), она обеспечивает асимптотическую устойчивость магистрали при небольших $T$.

\section{Оптимальное программное решение с применением Direct Single Shooting}

Для реализации алгоритма МРС из раздела \ref{mpcu} необходимо на шаге 2 решать прогнозирующую задачу оптимального управления, т.е. находить программное решение задач (\ref{41}), (\ref{42}), (\ref{43}).

Прогнозирующие задачи будут решаться численно с применением метода DSS из раздела 1.3, поэтому дальнейшее изложение будет посвящено программной реализации численных методов для решения задач (\ref{41}), (\ref{42}), (\ref{43}).

Приведем реализацию в Matlab использованием CasADi для самой простой задачи, коей является (\ref{41}).
Для начала зададим начальные условия:
\begin{lstlisting}
y0=1;
x0=0.1;
z0 = x0/y0;
\end{lstlisting}
Находим $z_1$, $p_1$ и проверяем какому случаю из таблицы \ref{tbll} соответствует задача с выбранными параметрами для этого создали функцию SteadyState. В ней мы находим $\beta_0,$ $\beta_1,$ $\beta_2$ и $z_1$:
\begin{lstlisting}
function [z_1,p_1] = SteadyState
    beta0 = rho + nu - b;
    beta1 = rho + nu - kappa*b;
    beta2 = rho + kappa*nu - kappa*b;

    if (beta0>0)  && (beta1>0) && (beta2>0) && (nu<b)
        fprintf('A1B1C1\n');
    end
    if (beta0>0)  && (beta1<=0) && (beta2>0) && (nu<b)
        fprintf('A1B1C2\n');
    end
    if (beta0>0)  && (beta1>0) && (beta2>0) && (nu>=b)
        fprintf('A1B1C3\n');
    end
    if (beta0>0)  && (beta1<=0) && (beta2>0) && (nu>=b)
        fprintf('A1B1C4\n');
    end
    if (beta0<0)  && (beta1>0) && (beta2>0)
        fprintf('A1B1C7\n');
    end
    sol = fsolve(@(x) [phi_1(x(1),x(2));
     phi_2(x(1),x(2))], [1;1]);
    z_1 = sol(1); p_1 = sol(2);

\end{lstlisting}
Объявим переменные и параметры модели, с которыми будем работать:
\begin{lstlisting}
 Переменные и параметры модели
t = SX.sym('t');
x1 = SX.sym('x1');
u = SX.sym('u');
xdot = (x1 + gamma)*u - nu*x1;

\end{lstlisting}

Подинтегральная функция критерия качества, так как у нас задача на максимум, а а встроенный алгоритм решает задачи на минимум в подынтегральную функцию возьмем с минусом:
\begin{lstlisting}
f0 = -exp(-rho*t)*(kappa*log(z1)+log(b-u));
\end{lstlisting}

Применим алгоритм Рунге-Кутты четвертого порядка для решения ОДУ:

\begin{lstlisting}
  DT = T/N;
   f = Function('f', {x1, u, t}, {xdot, f0});
   X0 = MX.sym('X0', n);
   U = MX.sym('U');
   tt = MX.sym('tt');
   X = X0;
   Q = 0;
       [k1, k1_q] = f(X, U, tt);
       [k2, k2_q] = f(X + DT/2 * k1, U, tt+DT/2);
       [k3, k3_q] = f(X + DT/2 * k2, U,tt+DT/2);
       [k4, k4_q] = f(X + DT * k3, U,tt+DT);
       X=X+DT/6*(k1 +2*k2 +2*k3 +k4);
       Q = Q + DT/6*(k1_q + 2*k2_q + 2*k3_q + k4_q);

    F = Function('F', {X0, U, tt}, {X, Q},
     {'x0','p','t'}, {'xf', 'qf'});

\end{lstlisting}
Собираем переменные и ограничения задачи (\ref{41}):
  \begin{lstlisting}
    u = MX.sym('u',N);
    z = MX.sym('z',n);
    J = 0;
    G = [];
    x = z;
    for k = 1:N
        res = F('x0', x, 'p', u(k), 't', (k-1)*DT);
        x   = res.xf;
         J   = J + res.qf;
        \end{lstlisting}
Для решения (\ref{42}) здесь добавляется:
\begin{lstlisting}
        g  = x-z_1;
        \end{lstlisting}
Для решения (\ref{43}) здесь добавляется:
  \begin{lstlisting}
        if k==N
            J=J-exp(-rho*T)*p_1*x;
        end
    end
\end{lstlisting}

После формулировки задачи нелинейного программирования и ограничений, для решения задачи создается solver --- процедура решения, в данном случае -- на основе встроенного алгоритма IPOPT.

\begin{lstlisting}
nlp = struct('f', J, 'x', [z(:); u(:)], 'g', []);
solver = nlpsol('solver', 'ipopt', nlp);

lbw = zeros(N,r);
ubw = (b-eps)*ones(N,r);
w0 = zeros(N,r);
xtau = z0;
tic
sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
t_Elapsed = toc;
\end{lstlisting}
Восстанавливаем  управление:
\begin{lstlisting}
J_opt = full(sol.f);
primal = full(sol.x);
u_opt = reshape(primal(n+1:end), r, N);
\end{lstlisting}
Для восстановление двойственных переменных будет с помощью пи-системы:
\begin{lstlisting}
function [X,P] = PIsystem(T,x0,pT,ud)
    ud = [ud ud(end)];
    u = @(t) ud(floor(t/DT)+1);
    sys_z = @(t,z) u(t)*(z+gamma) - nu*z;
    sol_z = ode45(sys_z, T, x0, odeopt);
    X = deval(sol_z,T);

    sys_p = @(t,p) (rho+nu-u(t))*p - kappa/deval(sol_z,t);
    sol_p = ode45(sys_p, flip(T), pT, odeopt);
    P = deval(sol_p,T);
end
\end{lstlisting}
Для восстановления двойственных переменных задачи (\ref{41}) передаем следующие параметры:
\begin{lstlisting}
[x_opt, p_opt] = PIsystem(0:DT:T, xtau, 0, u_opt);
\end{lstlisting}

Для задачи (\ref{42}) параметры для восстановления двойственных переменных выглядеть следующим образом:
\begin{lstlisting}
dual = exp(rho*DT*N)*abs(full(sol.lam_g));
[x_opt, p_opt] = PIsystem(0:DT:T, xtau, dual, u_opt);
\end{lstlisting}

Для восстановления двойственных переменных задачи (\ref{43}) передаем следующие параметры:
\begin{lstlisting}
[x_opt, p_opt] = PIsystem(0:DT:T, xtau, p_1, u_opt);
\end{lstlisting}

Для вывода результата была написала функция results которая выводит графики:
\begin{lstlisting}
results(0:DT:T, x_opt, u_opt,p_opt, J_opt, t_Elapsed, 1)
\end{lstlisting}

В следующем разделе рассмотрим результаты работы приведенной реализаций.

\section{Результаты численных экспериментов}

Рассмотрим различные решения задач (\ref{41})--(\ref{43}) в зависимости от изменений параметров:
\begin{itemize}
\item $b$ -- размеры трудовых ресурсов, пропорциональна размеру $L^B$ трудовых ресурсов страны-последователя,
\item $\gamma$ -- емкость абсорбции, т.к при описании параметрических областей, соответствующих всем реализуемым совмещенным случаям, не участвует емкость абсорбции $\gamma$ страны-последователя, изменение емкости абсорбции в пределах допустимого интервала (0,1) не меняет общую схему выбора страной-последователем оптимальной стратегии технологического роста в зависимости от начального соотношения $z_0$ запасов технологий.
\item $\rho$ -- параметр дисконтирования,
\item $\nu$ -- удельная скорость роста запаса технологий страны-лидера, линейно зависит от размера $L^A$ трудовых ресурсов страны-лидера,
\item $\kappa$ -- параметр эластичности замещения. При больших $\kappa$ значение эластичности замещения мало и наоборот, малые значения $\kappa$ соответствуют -- большим значениям значениям эластичности замещения.
\end{itemize}
Возможности страны-последователя описывают: $"$ресурсный$"$ параметр -- верхняя граница $b$ для значений управления и $"$информационный$"$ параметр -- емкость $\gamma$ абсорбции.

При соотношении параметров, отвечающих неособым невырожденным совмещенным случаям, схема выбора оптимального пути технологического развития для страны-последователя может быть выражена условной формулой: $"$начальный запас технологий мал по отношению к стране-лидеру (у $z_0$ малое значение) --- опережение с выравниванием, начальный запас технологий велик --- отставание с выравниванием$"$.
Опережение с выравниванием -- это оптимальный режим технологического развития страны-последователя, когда на старте процесса удельная скорость ее технологического роста, превосходит удельную скорость роста страны-лидера, она постепенно снижается, при этом все время больше $\nu$, в пределе на бесконечность сравнивается с $\nu$.

Значения параметров при решении задач будем выбирать согласно таблице \ref{table_params}. В таблице указан случай  из таблицы \ref{tbll}, которому соответствует данный набор параметров, а также магистральные значения прямой $z_1$ и сопряженной $p_1$ переменных. Выбрано начальное состояние $z_0=0.1$ для всех решений.

\begin{table}
\caption{Значения параметров при решении задач (\ref{41})--(\ref{43})}\label{table_params}

\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline

  № & $\gamma$ & $\nu$ & $b$ & $\rho$ & $\kappa$  & $\beta_0$ & $\beta_1$ & $\beta_2$ & Случай & $z_1$ & $p_1$  \\

  \hline
     1 & 0.5 & 0.7 & 0.7 & 0.1 & 1.3  & 0.1 & -0.11 & 0.1 & А1В1С4 &  1.81 & 2.86 \\

    \hline

    2 &  0.3 & 0.3 & 0.3 & 0.14 & 0.5 & 0.14 & 0.29 & 0.14 & А1В1С3 &  0.13 & 11.11 \\
    \hline

    3 & 0.1 & 0.5 & 0.55 & 0.15 & 1.5 & 0.1 & -0.175 & 0.075 & А1В1С2 & 0.54 & 12.21 \\
    \hline

     4 & 0.3 & 0.3 & 0.4 & 0.14 & 0.5 &  0.04 & 0.24 & 0.09 & А1В1С1 &  0.23 & 6.99 \\
    \hline

     5 & 0.5 & 0.3 & 0.4 & 0.14 & 1 &  0.04 & 0.04 & 0.04 & А1В1С1 & 2 & 2.5 \\
    \hline

     6 & 0.5 & 0.3 & 0.5 & 0.14 & 0.05 &  -0.06 & 0.19 & 0.04 & А1В1С7 & 0.81 & 2.43 \\
    \hline

  \end{tabular}
\end{table}


На рисунках \ref{fig:sl1} -- \ref{fig:sl63} изображены полученные результаты для всех наборов параметров и всех трех рассматриваемых задач.
В таблице \ref{table_fig} представлено соответствие рисунков результатам решения задач (\ref{41})--(\ref{43}).

\begin{table}[!h]
\caption{Соответствие рисунков результатам решения задач (\ref{41})--(\ref{43})}\label{table_fig}

\centering
\begin{tabular}{|c|c|c|c|}
\hline

  №  &  задача (\ref{41}) &  задача (\ref{42}) &  задача (\ref{43})\\
  \hline
     1 & рис. \ref{fig:sl1} & рис. \ref{fig:sl12} & рис. \ref{fig:sl13}\\
  \hline
    2 & рис. \ref{fig:sl3} & рис. \ref{fig:sl32}& рис. \ref{fig:sl33}\\
    \hline
     3 & рис. \ref{fig:sl4} & рис. \ref{fig:sl42} & рис. \ref{fig:sl43}\\
     \hline
     4 & рис. \ref{fig:sl5} & рис. \ref{fig:sl52}& рис. \ref{fig:sl53} \\
     \hline
     5& рис. \ref{fig:sl8} & рис. \ref{fig:sl82}& рис. \ref{fig:sl83} \\
     \hline
     6& рис. \ref{fig:sl6} & рис. \ref{fig:sl62} & рис. \ref{fig:sl63} \\
     \hline

  \end{tabular}
\end{table}

На каждом рисунке изображены четыре графика. Они соответствуют:
\begin{itemize}
  \item оптимальному программному управлению;
  \item соответствующей оптимальной траектории;
  \item оптимальной котраектории;
  \item фазовому портрету гамильтоновой системы, где серая область --- множество $\Gamma_2$, на котором оптимальное управление равно нулю, красные штриховые кривые --- это особые направления, точка их пересечения --- особая точка ($z_1,p_1)$ (магистраль).
\end{itemize}

Далее проведем анализ полученных результатов для каждой задачи.

% рис 4.1 и 4.2
\begin{figure}[!h]
\centering
\includegraphics[width=0.9\linewidth]{1.png}
\caption{Набор параметров № 1, подход 1, случай А1В1С4}
\label{fig:sl1}

\centering
\includegraphics[width=0.9\linewidth]{5.png}
\caption{Набор параметров № 2, подход 1, случай А1В1С3, $\nu = b$}
\label{fig:sl3}

\end{figure}

\clearpage


% рис 4.3 и 4.4
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{3.png}
\caption{Набор параметров № 3, подход 1, случай А1В1С2}
\label{fig:sl4}

\centering

\includegraphics[width=0.9\linewidth]{4.png}
\caption{Набор параметров № 4, подход 1, случай А1В1С1}
\label{fig:sl5}

\end{figure}

\clearpage
% рис 4.5 и 4.6
\begin{figure}
\centering
\includegraphics[width=0.9\linewidth]{8.png}
\caption{Набор параметров № 5, подход 1, случай А1В1С1}
\label{fig:sl8}


\centering
\includegraphics[width=0.9\linewidth]{6.png}
\caption{Набор параметров № 6, подход 1, случай А1В1С7}
\label{fig:sl6}

\end{figure}

\clearpage

% рис 4.7, 4.8,
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{12.png}
\caption{Набор параметров № 1, подход 2, случай А1В1С4}
\label{fig:sl12}

\centering
\includegraphics[width=0.9\linewidth]{52.png}
\caption{Набор параметров № 2, подход 2, случай А1В1С3, $\nu = b$}
\label{fig:sl32}
\end{figure}
%4.9, 4.10
\clearpage
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{32.png}
\caption{Набор параметров № 3, подход 2, случай А1В1С2}
\label{fig:sl42}

\centering
\includegraphics[width=0.9\linewidth]{42.png}
\caption{Набор параметров № 4, подход 2, случай А1В1С1}
\label{fig:sl52}

\end{figure}

\clearpage
% рис 4.11 и 4.12
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{82.png}
\caption{Набор параметров № 5, подход 2, случай А1В1С1}
\label{fig:sl82}


\includegraphics[width=0.9\linewidth]{62.png}
\caption{Набор параметров № 6, подход 2, случайА1В1С7}
\label{fig:sl62}
\end{figure}

\clearpage
% Рис. 4.13, 4.14
\begin{figure}[!h!]

\centering
\includegraphics[width=0.9\linewidth]{13.png}
\caption{Набор параметров № 1, подход 3, случай А1В1С4}
\label{fig:sl13}

\centering
\includegraphics[width=0.9\linewidth]{53.png}
\caption{Набор параметров № 2, подход 3, случай А1В1С3, $\nu = b$}
\label{fig:sl33}
\end{figure}

\clearpage
% рис 4.15, 4.16
\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{33.png}
\caption{Набор параметров № 3, подход 3, случай А1В1С2}
\label{fig:sl43}

\centering
\includegraphics[width=0.9\linewidth]{43.png}
\caption{Набор параметров № 4, подход 3, случай А1В1С1}
\label{fig:sl53}
\end{figure}
\clearpage
% рис 4.17, 4.18

\begin{figure}[!h]

\centering
\includegraphics[width=0.9\linewidth]{83.png}
\caption{Набор параметров № 5, подход 3, случай А1В1С1}
\label{fig:sl83}

\centering
\includegraphics[width=0.9\linewidth]{63.png}
\caption{Набор параметров № 6, подход 3, случай А1В1С7}
\label{fig:sl63}

\end{figure}

\clearpage
\subsection{Подход 1: Прогнозирующая задача для неограниченного EMPC}

Заметим, что все решения задачи (\ref{41}) обладают одной общей особенностью: оптимальная траектория является вогнутой, она сначала возрастает в направлении магистрального значения, а затем убывает. Насколько близко траектория подходит к магистральному значению, зависит от близости к нему начального состояния, которое во всех рассматриваемых случаях равно $z_0 = 0.1$ и оказывается меньше магистрального.

Заметим, что во всех случаях терминальное значение состояния $z(T)$ оказывается достаточно далеко от магистрали. При этом оптимальная котраектория в терминальный момент времени равна нулю: $p(T) = 0$. Это легко объясняется тем фактом, что $p$ -- теневая цена капитала, условие трансверсальности означает, что к моменту $\tau+T$ капитал теряет стоимость и его сохранение нецелесообразно. Соответственно, часть промежутка $[\tau,\tau+T]$ тратится на то, чтобы экономика избавилась от капитала, а теневая цена упала до нуля.

Рассмотрим набор параметров 1. При приближении $\gamma$ к допустимой верхней границе (единице) предельное отношение технологических запасов ($\overline{z}$) двух стран стремится к вполне определенной конечной верхней границе, и наоборот при приближении емкости абсорбции $\gamma$ страны-последователя к нулю предел технологических запасов страны-последователя и страны-лидера стремится к нулю. Эти эффекты, выполняются при относительной малости трудовых ресурсов страны-последователя, чаще всего это значит выполнение  $b \leq \nu$.

Рассмотрим набор параметров 5. В этом решении примечательно то, что страна-последователь накопит в два раза больше технологий, чем страна-лидер.
Страна-последователь, при оптимальном развитии, может расти в технологическом отношении быстрее, при опережении с выравниванием.

Рассмотрим набор параметров 6. В отличии от других неособых невырожденных совмещенных случаев, А1В1С7 предполагает $\beta_0<0$, это можно трактовать как то, что трудовой ресурс $b$ страны-последователя мал в сравнении с трудовым ресурсом страны-лидера. В то же время неравенства $\beta_1 >0,\ \beta_2 >0$ накладывают верхние ограничения на ресурс страны-последователя. Таким образом, при малом трудовой ресурсе страны-последователя, оптимальный режим ее роста характеризуется для неособых невырожденных совмещенных случаев также как говорилось ранее: $"$малый начальный запас технологий -- опережение с выравниванием, наоборот -- отставание с выравниванием$"$.

Рассмотрев ситуации, когда трудовые ресурсы страны-последователя относительно велики, т.е $b>\nu$. Изменения оптимального режима технологического роста страны-последователя при изменении ее параметра $\rho$ дисконтирования от нуля до бесконечности. Близость $\rho$ к нулю может толковаться так: страна-последователь следует пути $"$долгосрочного планирования$"$. В противном случае, большие значения параметра дисконтирования означают, что страна-последователь следует пути "краткосрочного планирования".

Значит, при $"$краткосрочной$"$ ориентации пути технологического развития потенциально мощная страна-последователь, выравниваясь в перспективе со страной-лидером по скорости технологического роста, начинает катастрофически отставать от нее по запасу накопленных технологий.


\subsection{Подход 2: с терминальным ограничением}

Рассмотрим решения (\ref{42}), при тех же наборах параметров что и (\ref{41}), для сравнения.
Как видно по рисункам решение с терминальным ограничением-равенство получается ближе к магистрали, а то и вовсе выходит на нее.

\subsection{Подход 3: с терминальной стоимостью}

Рассмотрим решения (\ref{43}), при тех же наборах параметров что и (\ref{41}), и (\ref{42}). В качестве значения параметра $\alpha$ выберем соответствующее $p_1$.


Сравним фазовые графики для задач (\ref{41}), (\ref{42}), (\ref{43}) при параметрах (случай А1В1С3), когда решение выходит на магистраль:
$$
    \gamma = 0.3, \ \nu = 0.3, \  b=0.4, \  \rho = 0.14, \ \kappa = 0.5, \ z_0=0.1.
    $$
Из рисунков \ref{fig:f1}--\ref{fig:f3} можем заметить, что при решении задач (\ref{42}), (\ref{43}) решения получаются ближе к магистрали.

\begin{figure}[!h!]
\begin{center}
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f41.png}
\caption{Задача (\ref{41})}
\label{fig:f1} %% метка рисунка для ссылки на него
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f42.png}
\caption{Задача (\ref{42})}
\label{fig:f2}
\end{minipage}
\hfill
\begin{minipage}[h]{0.32\linewidth}
\includegraphics[width=1\linewidth]{f43.png}
\caption{Задача (\ref{43})}
\label{fig:f3}
\end{minipage}
\end{center}
\end{figure}

\newpage

\section{Реализация алгоритма EМРС}

Реализуем алгоритм EMPC для задач (\ref{41})-(\ref{43}), с использованием Direct Single Shooting из предыдущего раздела.

В данной реализации xtau --- состояние системы в измеряемый момент времени, w0 --- начальное приближение для управления в момент $\tau +1$. В цикле по $\tau$ от 0 до Nmpc выполнить:

\begin{lstlisting}

sol = solver('x0', [xtau; w0],  'lbg', [], 'ubg', [],...
             'lbx', [xtau; lbw], 'ubx', [xtau; ubw]);
\end{lstlisting}

Выделяем решение.

\begin{lstlisting}
xu = full(sol.x);
u_opt = reshape(xu(n+1:end), r, N);
J_opt = full(sol.f);
\end{lstlisting}

Ищем следующее состояние системы.

\begin{lstlisting}
res = F('x0', xtau, 'p', u_opt(1));
xtau = full(res.xf);
\end{lstlisting}

Запоминаем текущее управление и состояние $X$.

\begin{lstlisting}
U = [U u_opt(1)];
X = [X xtau];
\end{lstlisting}
Изменяем начальное приближение:
\begin{lstlisting}
w0 = [u_opt(2:end) zeros(1)]';
end;
\end{lstlisting}

В следующем разделе рассмотрим результаты работы приведенной реализации.

\section{Применение методов по прогнозирующей модели для решения задачи роста}

Для численного эксперимента возьмём следующие параметры:
$T = 10$, $z_0=0.1$, $\gamma = 0.1$, $\nu = 0.5$, $b = 0.55$, $\rho = 0.15$, $\kappa =1.5$. Тогда $z_1=0.52$, $p_1=12.21 $.

При решении задачи базовым EMPC траектория  системы выходит на магистраль, однако для этого надо брать большой горизонт планирования, что увеличивает трудоемкость задачи.

\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc41.png}
\caption{Результаты решения задачи (\ref{41})}
\label{fig:empc41}
\end{figure}


На рисунке \ref{fig:empc41} представлены результаты решения:
\begin{itemize}
  \item на рисунке \ref{fig:empc41} а) штриховые линии соответствуют оптимальным траекториям $z^0(t|x(\tau)),$ $t \in [tau, tau+T]$, задачи (\ref{41}), сплошная линия -- траектория замкнутой системы, из рисунка видно, что оптимальные траектории задачи (\ref{41}) имеют продолжительные участки убывания;
  \item на рисунке \ref{fig:empc41} б) представлена реализация $u_{mpc}(t)$;
  \item на рисунке \ref{fig:empc41} в) фазовый график.
\end{itemize}
Из рисунка видно, что оптимальные траектории задачи (\ref{41}) имеют продолжительные участки убывания. Это связано с тем что в задаче (\ref{41}) условия оптимальности в форме принципа максимума имеют вид:
$$H(z,t,p) = \max_{0\le u \le b-\varepsilon} H(z^0(t),p^0(t),u) t \in [\tau,tau+T],$$
где $p^0(t)$, $t \in [\tau,\tau+T]$, --- решение сопряженной системы $$\dot{p}(t)= -(u^0(t)-\nu -\rho)p(t)-\frac{\kappa}{z^0(t)}$$ с условием трансверсальности $p(\tau+T)=0$.
\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc42.png}
\caption{Результаты решения задачи (\ref{42})}
\label{fig:empc42}
\end{figure}

На рисунке \ref{fig:empc42} представлены результаты решения задачи EPMC с терминальным ограничением-равенством:
\begin{itemize}
  \item на рисунке \ref{fig:empc42} а) штриховые линии соответствуют оптимальным траекториям $z^0(t|x(\tau)),$ $t \in [tau, tau+T]$, задачи (\ref{42}),;
  \item на рисунке \ref{fig:empc42} б) представлена реализация $u_{mpc}(t)$;
  \item на рисунке \ref{fig:empc42} в) фазовый график.
\end{itemize}

Из рисунка видно, что участки убывания функций $z^0(t|x(\tau)),$ $t \in [tau, tau+T]$ сократились. Траектории замкнутой системы и значения управления стремятся к магистральным значениям, однако возможны такие наборы параметров при которых задача (\ref{42}) недопустима, т.е. не существует ни одного допустимого управления, переводящего систему в состояние $z_1$.

Решение задачи EPMC с терминальной стоимостью при $T = 20$, $z_0=0.1$

На рисунке \ref{fig:empc43} представлены результаты решения:
\begin{itemize}
  \item на рисунке \ref{fig:empc43} а) штриховые линии изображают оптимальные траектории $z^0(t|x(\tau)),$ $t \in [tau, tau+T]$, задачи (\ref{43});
  \item на рисунке \ref{fig:empc43} б) представлена реализация $u_{mpc}(t)$;
  \item на рисунке \ref{fig:empc43} в) фазовый график.
\end{itemize}

\begin{figure}[!h!]
\centering
\includegraphics[width=1.1\linewidth]{empc43.png}
\caption{Результаты решения задачи (\ref{43})}
\label{fig:empc43}
\end{figure}

Из рисунка видно, что участки убывания функций $z^0(t|x(\tau)),$ $t \in [tau, tau+T]$ сократились. Траектории замкнутой системы и значения управления стремятся к магистральным значениям, время решения задачи сократилось в 2 раза. 